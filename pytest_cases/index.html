<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My personal digital garden"><meta name=author content=Lyz><link href=https://memo.nullniverse.xyz/pytest_cases/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-9.1.21"><title>Pytest cases - My Memo</title><link rel=stylesheet href=../assets/stylesheets/main.eebd395e.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ecc896b0.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#installing class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> You can find my posts on my <a href=https://blog.nullniverse.xyz/ ><strong>Blog</strong></a> <img src=img/blog_icon.png height=15 width=15> </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="My Memo" class="md-header__button md-logo" aria-label="My Memo" data-md-component=logo> <img src=../img/favicon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> My Memo </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Pytest cases </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/nullniverse/memo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nullniverse/memo </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="My Memo" class="md-nav__button md-logo" aria-label="My Memo" data-md-component=logo> <img src=../img/favicon.png alt=logo> </a> My Memo </label> <div class=md-nav__source> <a href=https://github.com/nullniverse/memo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nullniverse/memo </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../contact/ class=md-nav__link> Contact </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/devops/ >DevOps</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> DevOps </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> Infrastructure as Code <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Infrastructure as Code </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gitea/ class=md-nav__link> Gitea </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/helm/helm/ >Helm</a> <label for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/helm/helm_installation/ class=md-nav__link> Helm Installation </a> </li> <li class=md-nav__item> <a href=../devops/helm/helm_commands/ class=md-nav__link> Helm Commands </a> </li> <li class=md-nav__item> <a href=../devops/helm/helm_secrets/ class=md-nav__link> Helm Secrets </a> </li> <li class=md-nav__item> <a href=../helm_git/ class=md-nav__link> Helm Git </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/helmfile/ class=md-nav__link> Helmfile </a> </li> <li class=md-nav__item> <a href=../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../ansible_snippets/ class=md-nav__link> Ansible Snippets </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_6> <div class="md-nav__link md-nav__link--index "> <a href=../dotfiles/ >Dotfiles</a> <label for=__nav_3_1_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_6> <span class="md-nav__icon md-icon"></span> Dotfiles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chezmoi/ class=md-nav__link> Chezmoi </a> </li> <li class=md-nav__item> <a href=../dotdrop/ class=md-nav__link> Dotdrop </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> Infrastructure Solutions <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Infrastructure Solutions </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubernetes/kubernetes/ >Kubernetes</a> <label for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_architecture/ class=md-nav__link> Architecture </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_2> <label class=md-nav__link for=__nav_3_2_1_2 id=__nav_3_2_1_2_label tabindex=0> Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_2> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_namespaces/ class=md-nav__link> Namespaces </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_pods/ class=md-nav__link> Pods </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_replicasets/ class=md-nav__link> ReplicaSets </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_deployments/ class=md-nav__link> Deployments </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_volumes/ class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_services/ class=md-nav__link> Services </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_labels/ class=md-nav__link> Labels </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_annotations/ class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_ingress/ class=md-nav__link> Ingress </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_operators/ class=md-nav__link> Operators </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_jobs/ class=md-nav__link> Jobs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubectl/kubectl/ >Kubectl</a> <label for=__nav_3_2_1_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_3> <span class="md-nav__icon md-icon"></span> Kubectl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubectl/kubectl_installation/ class=md-nav__link> Kubectl Installation </a> </li> <li class=md-nav__item> <a href=../devops/kubectl/kubectl_commands/ class=md-nav__link> Kubectl Commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_4> <label class=md-nav__link for=__nav_3_2_1_4 id=__nav_3_2_1_4_label tabindex=0> Additional Components <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_4> <span class="md-nav__icon md-icon"></span> Additional Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_metric_server/ class=md-nav__link> Metrics Server </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_ingress_controller/ class=md-nav__link> Ingress Controller </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_external_dns/ class=md-nav__link> External DNS </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_cluster_autoscaler/ class=md-nav__link> Cluster Autoscaler </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_dashboard/ class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_storage_driver/ class=md-nav__link> Storage Driver </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_vertical_pod_autoscaler/ class=md-nav__link> Vertical Pod Autoscaler </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_networking/ class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../kubernetes_debugging/ class=md-nav__link> Debugging </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_7> <label class=md-nav__link for=__nav_3_2_1_7 id=__nav_3_2_1_7_label tabindex=0> Backups <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_7> <span class="md-nav__icon md-icon"></span> Backups </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../velero/ class=md-nav__link> Velero </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_8> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubernetes/kubernetes_tools/ >Tools</a> <label for=__nav_3_2_1_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_8> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../krew/ class=md-nav__link> Krew </a> </li> <li class=md-nav__item> <a href=../ksniff/ class=md-nav__link> Ksniff </a> </li> <li class=md-nav__item> <a href=../mizu/ class=md-nav__link> Mizu </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/aws/aws/ >AWS</a> <label for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws_snippets/ class=md-nav__link> AWS Snippets </a> </li> <li class=md-nav__item> <a href=../aws_savings_plan/ class=md-nav__link> AWS Savings plan </a> </li> <li class=md-nav__item> <a href=../devops/aws/security_groups/ class=md-nav__link> Security groups workflow </a> </li> <li class=md-nav__item> <a href=../devops/aws/eks/ class=md-nav__link> EKS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2_5> <div class="md-nav__link md-nav__link--index "> <a href=../devops/aws/iam/iam/ >IAM</a> <label for=__nav_3_2_2_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2_5> <span class="md-nav__icon md-icon"></span> IAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/aws/iam/iam_commands/ class=md-nav__link> IAM Commands </a> </li> <li class=md-nav__item> <a href=../devops/aws/iam/iam_debug/ class=md-nav__link> IAM Debugging </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/aws/s3/ class=md-nav__link> S3 </a> </li> <li class=md-nav__item> <a href=../aws_waf/ class=md-nav__link> WAF </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/ci/ >Continuous Integration</a> <label for=__nav_3_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Continuous Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../drone/ class=md-nav__link> Drone </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_2> <label class=md-nav__link for=__nav_3_3_2 id=__nav_3_3_2_label tabindex=0> Linters <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Linters </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/alex/ class=md-nav__link> Alex </a> </li> <li class=md-nav__item> <a href=../flakeheaven/ class=md-nav__link> Flakeheaven </a> </li> <li class=md-nav__item> <a href=../devops/flake8/ class=md-nav__link> Flake8 </a> </li> <li class=md-nav__item> <a href=../devops/markdownlint/ class=md-nav__link> Markdownlint </a> </li> <li class=md-nav__item> <a href=../devops/proselint/ class=md-nav__link> Proselint </a> </li> <li class=md-nav__item> <a href=../devops/yamllint/ class=md-nav__link> Yamllint </a> </li> <li class=md-nav__item> <a href=../devops/write_good/ class=md-nav__link> Write Good </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_3> <label class=md-nav__link for=__nav_3_3_3 id=__nav_3_3_3_label tabindex=0> Formatters/Fixers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_3> <span class="md-nav__icon md-icon"></span> Formatters/Fixers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/black/ class=md-nav__link> Black </a> </li> <li class=md-nav__item> <a href=../yamlfix/ class=md-nav__link> Yamlfix </a> </li> <li class=md-nav__item> <a href=../pyment/ class=md-nav__link> Pyment </a> </li> <li class=md-nav__item> <a href=../mdformat/ class=md-nav__link> mdformat </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_4> <label class=md-nav__link for=__nav_3_3_4 id=__nav_3_3_4_label tabindex=0> Type Checkers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_4> <span class="md-nav__icon md-icon"></span> Type Checkers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/mypy/ class=md-nav__link> Mypy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_5> <label class=md-nav__link for=__nav_3_3_5 id=__nav_3_3_5_label tabindex=0> Security Checkers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_5> <span class="md-nav__icon md-icon"></span> Security Checkers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/safety/ class=md-nav__link> Safety </a> </li> <li class=md-nav__item> <a href=../devops/bandit/ class=md-nav__link> Bandit </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_6> <label class=md-nav__link for=__nav_3_3_6 id=__nav_3_3_6_label tabindex=0> Dependency managers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_6> <span class="md-nav__icon md-icon"></span> Dependency managers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/pip_tools/ class=md-nav__link> Pip-tools </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> Automating Processes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Automating Processes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../linux/cookiecutter/ class=md-nav__link> cookiecutter </a> </li> <li class=md-nav__item> <a href=../linux/cruft/ class=md-nav__link> cruft </a> </li> <li class=md-nav__item> <a href=../renovate/ class=md-nav__link> renovate </a> </li> <li class=md-nav__item> <a href=../letsencrypt/ class=md-nav__link> letsencrypt </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <div class="md-nav__link md-nav__link--index "> <a href=../storage/ >Storage</a> <label for=__nav_3_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_1> <div class="md-nav__link md-nav__link--index "> <a href=../linux/zfs/ >OpenZFS</a> <label for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> OpenZFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../zfs_storage_planning/ class=md-nav__link> OpenZFS storage planning </a> </li> <li class=md-nav__item> <a href=../sanoid/ class=md-nav__link> Sanoid </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../monitoring_comparison/ class=md-nav__link> Monitoring Comparison </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/prometheus/prometheus/ >Prometheus</a> <label for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> Prometheus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_architecture/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_operator/ class=md-nav__link> Prometheus Operator </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_installation/ class=md-nav__link> Prometheus Install </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/alertmanager/ class=md-nav__link> AlertManager </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/blackbox_exporter/ class=md-nav__link> Blackbox Exporter </a> </li> <li class=md-nav__item> <a href=../elasticsearch_exporter/ class=md-nav__link> Elasticsearch Exporter </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/node_exporter/ class=md-nav__link> Node Exporter </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/instance_sizing_analysis/ class=md-nav__link> Instance sizing analysis </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_troubleshooting/ class=md-nav__link> Prometheus Troubleshooting </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> Authentication <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Authentication </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../authentik/ class=md-nav__link> Authentik </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex=0> Self-hosted services <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Self-hosted services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ombi/ class=md-nav__link> Ombi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <div class="md-nav__link md-nav__link--index "> <a href=../devops/api_management/ >API Management</a> <label for=__nav_3_9> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> API Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kong/kong/ class=md-nav__link> Kong </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <div class="md-nav__link md-nav__link--index "> <a href=../language/language/ >Language Learning</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Language Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../language/chinese/chinese/ class=md-nav__link> Chinese </a> </li> <li class=md-nav__item> <a href=../language/russian/russian/ class=md-nav__link> Russian </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installing class=md-nav__link> Installing </a> </li> <li class=md-nav__item> <a href=#why-pytest-cases class=md-nav__link> Why pytest-cases? </a> </li> <li class=md-nav__item> <a href=#basic-usage class=md-nav__link> Basic usage </a> <nav class=md-nav aria-label="Basic usage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#case-functions class=md-nav__link> Case functions </a> </li> <li class=md-nav__item> <a href=#test-functions class=md-nav__link> Test functions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cases-collection class=md-nav__link> Cases collection </a> <nav class=md-nav aria-label="Cases collection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#alternate-sources class=md-nav__link> Alternate source(s) </a> </li> <li class=md-nav__item> <a href=#alternate-prefix class=md-nav__link> Alternate prefix </a> </li> <li class=md-nav__item> <a href=#filters-and-tags class=md-nav__link> Filters and tags </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pytest-marks-skip-xfail-on-cases class=md-nav__link> Pytest marks (skip, xfail...) on cases </a> </li> <li class=md-nav__item> <a href=#case-generators class=md-nav__link> Case generators </a> </li> <li class=md-nav__item> <a href=#cases-requiring-fixtures class=md-nav__link> Cases requiring fixtures </a> </li> <li class=md-nav__item> <a href=#parametrize-fixtures-with-cases class=md-nav__link> Parametrize fixtures with cases </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pytest-cases-internals class=md-nav__link> Pytest-cases internals </a> <nav class=md-nav aria-label="Pytest-cases internals"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fixture class=md-nav__link> @fixture </a> <nav class=md-nav aria-label=@fixture> <ul class=md-nav__list> <li class=md-nav__item> <a href=#unpack_fixture-unpack_into class=md-nav__link> unpack_fixture / unpack_into </a> </li> <li class=md-nav__item> <a href=#param_fixtures class=md-nav__link> param_fixture[s] </a> </li> <li class=md-nav__item> <a href=#fixture_union class=md-nav__link> fixture_union </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Pytest cases</h1> <p><a href=https://smarie.github.io/python-pytest-cases/ >pytest-cases</a> is a pytest plugin that allows you to <em>separate your test cases from your test functions</em>.</p> <p>In addition, <code>pytest-cases</code> provides <a href=https://smarie.github.io/python-pytest-cases/pytest_goodies/ >several useful goodies</a> to empower <code>pytest</code>. In particular it improves the fixture mechanism to support "fixture unions". This is a major change in the internal <code>pytest</code> engine, unlocking many possibilities such as using fixture references as parameter values in a test function.</p> <h2 id=installing><a href=https://smarie.github.io/python-pytest-cases/#installing>Installing</a><a class=headerlink href=#installing title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code>pip<span class=w> </span>install<span class=w> </span>pytest_cases
</code></pre></div> <div class="admonition note"> <p>Installing pytest-cases has effects on the order of <code>pytest</code> tests execution, even if you do not use its features. One positive side effect is that it fixed <a href=https://github.com/pytest-dev/pytest/issues/5054>pytest#5054</a>. But if you see less desirable ordering please <a href=https://github.com/smarie/python-pytest-cases/issues>report it</a>.</p> </div> <h2 id=why-pytest-cases><a href=https://smarie.github.io/python-pytest-cases/#why-pytest-cases>Why <code>pytest-cases</code>?</a><a class=headerlink href=#why-pytest-cases title="Permanent link">⚑</a></h2> <p>Let's consider the following <code>foo</code> function under test, located in <code>example.py</code>:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>a</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>b</span> <span class=o>+</span> <span class=mi>1</span>
</code></pre></div> <p>If we were using plain <code>pytest</code> to test it with various inputs, we would create a <code>test_foo.py</code> file and use <code>@pytest.mark.parametrize</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pytest</span>
<span class=kn>from</span> <span class=nn>example</span> <span class=kn>import</span> <span class=n>foo</span>

<span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>parametrize</span><span class=p>(</span><span class=s2>&quot;a,b&quot;</span><span class=p>,</span> <span class=p>[(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>)])</span>
<span class=k>def</span> <span class=nf>test_foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=c1># check that foo runs correctly and that the result is a tuple.</span>
    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>),</span> <span class=nb>tuple</span><span class=p>)</span>
</code></pre></div> <p>This is the fastest and most compact thing to do when you have a few number of test cases, that do not require code to generate each test case.</p> <p>Now imagine that instead of <code>(1, 2)</code> and <code>(-1, -2)</code> each of our test cases:</p> <ul> <li>Requires a few lines of code to be generated.</li> <li>Requires documentation to explain the other developers the intent of that precise test case.</li> <li>Requires external resources (data files on the filesystem, databases...), with a variable number of cases depending on what is available on the resource.</li> <li>Requires a readable <code>id</code>, such as <code>'uniformly_sampled_nonsorted_with_holes'</code> for the above example. Of course we <em>could</em> use <a href=https://docs.pytest.org/en/stable/example/parametrize.html#set-marks-or-test-id-for-individual-parametrized-test><code>pytest.param</code></a> or <a href=https://docs.pytest.org/en/stable/example/parametrize.html#different-options-for-test-ids><code>ids=&lt;list&gt;</code></a> but that is "a pain to maintain" according to <code>pytest</code> doc. Such a design does not feel right as the id is detached from the case.</li> </ul> <p>With standard <code>pytest</code> there is no particular pattern to simplify your life here. Investigating a little bit, people usually end up trying to mix parameters and fixtures and asking this kind of question: <a href=https://stackoverflow.com/questions/50231627/python-pytest-unpack-fixture>so1</a>, <a href=https://stackoverflow.com/questions/50482416/use-pytest-lazy-fixture-list-values-as-parameters-in-another-fixture>so2</a>. But by design it is not possible to solve this problem using fixtures, because <code>pytest</code> <a href=https://smarie.github.io/python-pytest-cases/unions_theory/ >does not handle "unions" of fixtures</a>.</p> <p>There is also an example in <code>pytest</code> doc <a href=https://docs.pytest.org/en/stable/example/parametrize.html#a-quick-port-of-testscenarios>with a <code>metafunc</code> hook</a>.</p> <p>The issue with such workarounds is that you can do <em>anything</em>. And <em>anything</em> is a bit too much: this does not provide any convention / "good practice" on how to organize test cases, which is an open door to developing ad-hoc unreadable or unmaintainable solutions.</p> <p><code>pytest_cases</code> was created to provide an answer to this precise situation. It proposes a simple framework to separate test cases from test functions. The test cases are typically located in a separate "companion" file:</p> <ul> <li><code>test_foo.py</code> is your usual test file containing the test <em>functions</em> (named <code>test_&lt;id&gt;</code>).</li> <li><code>test_foo_cases.py</code> contains the test <em>cases</em>, that are also functions. Note: an alternate file naming style <code>cases_foo.py</code> is also available if you prefer it.</li> </ul> <h2 id=basic-usage><a href=https://smarie.github.io/python-pytest-cases/#basic-usage>Basic usage</a><a class=headerlink href=#basic-usage title="Permanent link">⚑</a></h2> <h3 id=case-functions><a href=https://smarie.github.io/python-pytest-cases/#a-case-functions>Case functions</a><a class=headerlink href=#case-functions title="Permanent link">⚑</a></h3> <p>Let's create a <code>test_foo_cases.py</code> file. This file will contain <em>test cases generator functions</em>, that we will call <em>case functions</em> for brevity. In these functions, you will typically either parse some test data files, generate some simulated test data, expected results, etc.</p> <div class="admonition note"> <p class=admonition-title>File: test_foo_cases.py</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>case_two_positive_ints</span><span class=p>():</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot; Inputs are two positive integers &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span>

<span class=k>def</span> <span class=nf>case_two_negative_ints</span><span class=p>():</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot; Inputs are two negative integers &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span>
</code></pre></div> </div> <p>Case functions can return anything that is considered useful to run the associated test. You can use all classic pytest mechanism on case functions (id customization, skip/fail marks, parametrization or fixtures injection).</p> <h3 id=test-functions><a href=https://smarie.github.io/python-pytest-cases/#b-test-functions>Test functions</a><a class=headerlink href=#test-functions title="Permanent link">⚑</a></h3> <p>As usual we write our <code>pytest</code> test functions starting with <code>test_</code>, in a <code>test_foo.py</code> file. The only difference is that we now decorate it with <code>@parametrize_with_cases</code> instead of <code>@pytest.mark.parametrize</code> as we were doing previously:</p> <div class="admonition note"> <p class=admonition-title>File: test_foo.py</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>example</span> <span class=kn>import</span> <span class=n>foo</span>
<span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>parametrize_with_cases</span>

<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;a,b&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=c1># check that foo runs correctly and that the result is a tuple.</span>
    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>),</span> <span class=nb>tuple</span><span class=p>)</span>
</code></pre></div> </div> <p>Executing <code>pytest</code> will now run our test function once for every case function:</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt;<span class=w> </span>pytest<span class=w> </span>-s<span class=w> </span>-v
<span class=o>=============================</span><span class=w> </span><span class=nb>test</span><span class=w> </span>session<span class=w> </span><span class=nv>starts</span><span class=w> </span><span class=o>=============================</span>
<span class=o>(</span>...<span class=o>)</span>
&lt;your_project&gt;/tests/test_foo.py::test_foo<span class=o>[</span>two_positive_ints<span class=o>]</span><span class=w> </span>PASSED<span class=w> </span><span class=o>[</span><span class=w> </span><span class=m>50</span>%<span class=o>]</span>
&lt;your_project&gt;/tests/test_foo.py::test_foo<span class=o>[</span>two_negative_ints<span class=o>]</span><span class=w> </span>PASSED<span class=w> </span><span class=o>[</span><span class=w> </span><span class=m>100</span>%<span class=o>]</span>

<span class=o>==========================</span><span class=w> </span><span class=m>2</span><span class=w> </span>passed<span class=w> </span><span class=k>in</span><span class=w> </span><span class=m>0</span>.24<span class=w> </span><span class=nv>seconds</span><span class=w> </span><span class=o>==========================</span>
</code></pre></div> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">⚑</a></h2> <h3 id=cases-collection><a href=https://smarie.github.io/python-pytest-cases/#a-cases-collection>Cases collection</a><a class=headerlink href=#cases-collection title="Permanent link">⚑</a></h3> <h4 id=alternate-sources><a href=https://smarie.github.io/python-pytest-cases/#alternate-sources>Alternate source(s)</a><a class=headerlink href=#alternate-sources title="Permanent link">⚑</a></h4> <p>It is not mandatory that case functions should be in a different file than the test functions: both can be in the same file. For this you can use <code>cases='.'</code> or <code>cases=THIS_MODULE</code> to refer to the module in which the test function is located:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>parametrize_with_cases</span>

<span class=k>def</span> <span class=nf>case_one_positive_int</span><span class=p>():</span>
    <span class=k>return</span> <span class=mi>1</span>

<span class=k>def</span> <span class=nf>case_one_negative_int</span><span class=p>():</span>
    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>

<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;i&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_with_this_module</span><span class=p>(</span><span class=n>i</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>i</span> <span class=o>==</span> <span class=nb>int</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</code></pre></div> <div class="admonition warning"> <p>Only the case functions defined BEFORE the test function in the module file will be taken into account.</p> </div> <p><code>@parametrize_with_cases(cases=...)</code> also accepts explicit list of case functions, classes containing case functions, and modules. See <a href=https://smarie.github.io/python-pytest-cases/api_reference/#parametrize_with_cases>API Reference</a> for details. A typical way to organize cases is to use classes for example:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>parametrize_with_cases</span>

<span class=k>class</span> <span class=nc>Foo</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>case_a_positive_int</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=mi>1</span>

    <span class=k>def</span> <span class=nf>case_another_positive_int</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=mi>2</span>

<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;a&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=n>Foo</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_foo</span><span class=p>(</span><span class=n>a</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>a</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <p>Note that as for <code>pytest</code>, <code>self</code> is recreated for every test and therefore should not be used to store any useful information.</p> <h4 id=alternate-prefix><a href=https://smarie.github.io/python-pytest-cases/#alternate-prefix>Alternate prefix</a><a class=headerlink href=#alternate-prefix title="Permanent link">⚑</a></h4> <p><code>case_</code> might not be your preferred prefix, especially if you wish to store in the same module or class various kind of case data. <code>@parametrize_with_cases</code> offers a <code>prefix=...</code> argument to select an alternate prefix for your case functions. That way, you can store in the same module or class case functions as diverse as datasets (e.g. <code>data_</code>), user descriptions (e.g. <code>user_</code>), algorithms or machine learning models (e.g. <code>model_</code> or <code>algo_</code>), etc.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>parametrize_with_cases</span><span class=p>,</span> <span class=n>parametrize</span>

<span class=k>def</span> <span class=nf>data_a</span><span class=p>():</span>
    <span class=k>return</span> <span class=s1>&#39;a&#39;</span>

<span class=nd>@parametrize</span><span class=p>(</span><span class=s2>&quot;hello&quot;</span><span class=p>,</span> <span class=p>[</span><span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>data_b</span><span class=p>(</span><span class=n>hello</span><span class=p>):</span>
    <span class=k>return</span> <span class=s2>&quot;hello&quot;</span> <span class=k>if</span> <span class=n>hello</span> <span class=k>else</span> <span class=s2>&quot;world&quot;</span>

<span class=k>def</span> <span class=nf>case_c</span><span class=p>():</span>
    <span class=k>return</span> <span class=nb>dict</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;hi i&#39;m not used&quot;</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>user_bob</span><span class=p>():</span>
    <span class=k>return</span> <span class=s2>&quot;bob&quot;</span>

<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;data&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=n>prefix</span><span class=o>=</span><span class=s2>&quot;data_&quot;</span><span class=p>)</span>
<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=n>prefix</span><span class=o>=</span><span class=s2>&quot;user_&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_with_data</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>user</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>data</span> <span class=ow>in</span> <span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s2>&quot;hello&quot;</span><span class=p>,</span> <span class=s2>&quot;world&quot;</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>user</span> <span class=o>==</span> <span class=s1>&#39;bob&#39;</span>
</code></pre></div> <p>Yields</p> <div class=highlight><pre><span></span><code>test_doc_filters_n_tags.py::test_with_data[bob-a]       PASSED [ 33%]
test_doc_filters_n_tags.py::test_with_data[bob-b-True]   PASSED [ 66%]
test_doc_filters_n_tags.py::test_with_data[bob-b-False]   PASSED [ 100%]
</code></pre></div> <h4 id=filters-and-tags><a href=https://smarie.github.io/python-pytest-cases/#filters-and-tags>Filters and tags</a><a class=headerlink href=#filters-and-tags title="Permanent link">⚑</a></h4> <p>The easiest way to select only a subset of case functions in a module or a class, is to specify a custom <code>prefix</code> instead of the default one (<code>'case_'</code>).</p> <p>However sometimes more advanced filtering is required. In that case, you can also rely on three additional mechanisms provided in <code>@parametrize_with_cases</code>:</p> <ul> <li> <p>The <code>glob</code> argument can contain a glob-like pattern for case ids. This can become handy to separate for example good or bad cases, the latter returning an expected error type and/or message for use with <code>pytest.raises</code> or with our alternative <a href=https://smarie.github.io/python-pytest-cases/pytest_goodies/#assert_exception><code>assert_exception</code></a>.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>math</span> <span class=kn>import</span> <span class=n>sqrt</span>
<span class=kn>import</span> <span class=nn>pytest</span>
<span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>parametrize_with_cases</span>


<span class=k>def</span> <span class=nf>case_int_success</span><span class=p>():</span>
    <span class=k>return</span> <span class=mi>1</span>

<span class=k>def</span> <span class=nf>case_negative_int_failure</span><span class=p>():</span>
    <span class=c1># note that we decide to return the expected type of failure to check it</span>
    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>,</span> <span class=s2>&quot;math domain error&quot;</span>


<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;data&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=n>glob</span><span class=o>=</span><span class=s2>&quot;*success&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_good_datasets</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>sqrt</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>

<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;data, err_type, err_msg&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=n>glob</span><span class=o>=</span><span class=s2>&quot;*failure&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_bad_datasets</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>err_type</span><span class=p>,</span> <span class=n>err_msg</span><span class=p>):</span>
    <span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=n>err_type</span><span class=p>,</span> <span class=n>match</span><span class=o>=</span><span class=n>err_msg</span><span class=p>):</span>
        <span class=n>sqrt</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</code></pre></div> </li> <li> <p>The <code>has_tag</code> argument allows you to filter cases based on tags set on case functions using the <code>@case</code> decorator. See API reference of <a href=https://smarie.github.io/python-pytest-cases/api_reference/#case><code>@case</code></a> and <a href=https://smarie.github.io/python-pytest-cases/api_reference/#parametrize_with_cases><code>@parametrize_with_cases</code></a>.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>parametrize_with_cases</span><span class=p>,</span> <span class=n>case</span>

<span class=k>class</span> <span class=nc>FooCases</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>case_two_positive_ints</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span>

    <span class=nd>@case</span><span class=p>(</span><span class=n>tags</span><span class=o>=</span><span class=s1>&#39;foo&#39;</span><span class=p>)</span>
    <span class=k>def</span> <span class=nf>case_one_positive_int</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=mi>1</span>

<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;a&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=n>FooCases</span><span class=p>,</span> <span class=n>has_tag</span><span class=o>=</span><span class=s1>&#39;foo&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_foo</span><span class=p>(</span><span class=n>a</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>a</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> </li> <li> <p>Finally if none of the above matches your expectations, you can provide a callable to <code>filter</code>. This callable will receive each collected case function and should return <code>True</code> in case of success. Note that your function can leverage the <code>_pytestcase</code> attribute available on the case function to read the tags, marks and id found on it.</p> <div class=highlight><pre><span></span><code><span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;data&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>,</span>
                        <span class=nb>filter</span><span class=o>=</span><span class=k>lambda</span> <span class=n>cf</span><span class=p>:</span> <span class=s2>&quot;success&quot;</span> <span class=ow>in</span> <span class=n>cf</span><span class=o>.</span><span class=n>_pytestcase</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_good_datasets2</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>sqrt</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</code></pre></div> <h3 id=pytest-marks-skip-xfail-on-cases><a href=https://smarie.github.io/python-pytest-cases/#pytest-marks-skip-xfail>Pytest marks (<code>skip</code>, <code>xfail</code>...) on cases</a><a class=headerlink href=#pytest-marks-skip-xfail-on-cases title="Permanent link">⚑</a></h3> </li> </ul> <p>pytest marks such as <code>@pytest.mark.skipif</code> can be applied on case functions the same way <a href=https://docs.pytest.org/en/stable/skipping.html>as with test functions</a>.</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>sys</span>
<span class=kn>import</span> <span class=nn>pytest</span>

<span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>skipif</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>version_info</span> <span class=o>&lt;</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>reason</span><span class=o>=</span><span class=s2>&quot;Not useful on python 2&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>case_two_positive_ints</span><span class=p>():</span>
    <span class=k>return</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span>
</code></pre></div> <h3 id=case-generators><a href=https://smarie.github.io/python-pytest-cases/#case-generators>Case generators</a><a class=headerlink href=#case-generators title="Permanent link">⚑</a></h3> <p>In many real-world usage we want to generate one test case <em>per</em> <code>&lt;something&gt;</code>. The most intuitive way would be to use a <code>for</code> loop to create the case functions, and to use the <code>@case</code> decorator to set their names ; however this would not be very readable.</p> <p>Instead, case functions can be parametrized the same way <a href=https://docs.pytest.org/en/stable/parametrize.html>as with test functions</a>: simply add the parameter names as arguments in their signature and decorate with <code>@pytest.mark.parametrize</code>. Even better, you can use the enhanced <a href=https://smarie.github.io/python-pytest-cases/api_reference/#parametrize><code>@parametrize</code></a> from <code>pytest-cases</code> so as to benefit from its additional usability features:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>parametrize</span><span class=p>,</span> <span class=n>parametrize_with_cases</span>

<span class=k>class</span> <span class=nc>CasesFoo</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>case_hello</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;hello world&quot;</span>

    <span class=nd>@parametrize</span><span class=p>(</span><span class=n>who</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;you&#39;</span><span class=p>,</span> <span class=s1>&#39;there&#39;</span><span class=p>))</span>
    <span class=k>def</span> <span class=nf>case_simple_generator</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>who</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;hello </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=n>who</span>


<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;msg&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=n>CasesFoo</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_foo</span><span class=p>(</span><span class=n>msg</span><span class=p>):</span>
    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span> <span class=ow>and</span> <span class=n>msg</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;hello&quot;</span><span class=p>)</span>
</code></pre></div> <p>Yields</p> <div class=highlight><pre><span></span><code>test_generators.py::test_foo[hello] PASSED               [ 33%]
test_generators.py::test_foo[simple_generator-who=you] PASSED [ 66%]
test_generators.py::test_foo[simple_generator-who=there] PASSED [100%]
</code></pre></div> <h3 id=cases-requiring-fixtures><a href=https://smarie.github.io/python-pytest-cases/#cases-requiring-fixtures>Cases requiring fixtures</a><a class=headerlink href=#cases-requiring-fixtures title="Permanent link">⚑</a></h3> <p>Cases can use fixtures the same way as <a href=https://docs.pytest.org/en/stable/fixture.html#fixtures-as-function-arguments>test functions do</a>: simply add the fixture names as arguments in their signature and make sure the fixture exists either in the same module, or in a <a href="https://docs.pytest.org/en/stable/fixture.html?highlight=conftest.py#conftest-py-sharing-fixture-functions"><code>conftest.py</code></a> file in one of the parent packages. See <a href="https://docs.pytest.org/en/stable/fixture.html?highlight=conftest.py#conftest-py-sharing-fixture-functions"><code>pytest</code> documentation on sharing fixtures</a>.</p> <div class="admonition warning"> <p class=admonition-title>Use <code>@fixture</code> instead of <code>@pytest.fixture</code></p> <p>If a fixture is used by <em>some</em> of your cases only, then you <em>should</em> use the <code>@fixture</code> decorator from pytest-cases instead of the standard <code>@pytest.fixture</code>. Otherwise you fixture will be setup/teardown for all cases even those not requiring it. See <a href=https://smarie.github.io/python-pytest-cases/api_reference/#fixture><code>@fixture</code> doc</a>.</p> </div> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>parametrize_with_cases</span><span class=p>,</span> <span class=n>fixture</span><span class=p>,</span> <span class=n>parametrize</span>

<span class=nd>@fixture</span><span class=p>(</span><span class=n>scope</span><span class=o>=</span><span class=s1>&#39;session&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>db</span><span class=p>():</span>
    <span class=k>return</span> <span class=p>{</span><span class=mi>0</span><span class=p>:</span> <span class=s1>&#39;louise&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>:</span> <span class=s1>&#39;bob&#39;</span><span class=p>}</span>

<span class=k>def</span> <span class=nf>user_bob</span><span class=p>(</span><span class=n>db</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>db</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>

<span class=nd>@parametrize</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
<span class=k>def</span> <span class=nf>user_from_db</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=nb>id</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>db</span><span class=p>[</span><span class=nb>id</span><span class=p>]</span>

<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;a&quot;</span><span class=p>,</span> <span class=n>cases</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=n>prefix</span><span class=o>=</span><span class=s1>&#39;user_&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_users</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>request</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;this is test </span><span class=si>%r</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=n>request</span><span class=o>.</span><span class=n>node</span><span class=o>.</span><span class=n>nodeid</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>values</span><span class=p>()</span>
</code></pre></div> <p>Yields</p> <div class=highlight><pre><span></span><code>test_fixtures.py::test_users[a_is_bob]
test_fixtures.py::test_users[a_is_from_db-id=0]
test_fixtures.py::test_users[a_is_from_db-id=1]
</code></pre></div> <h3 id=parametrize-fixtures-with-cases><a href=https://smarie.github.io/python-pytest-cases/#a-test-fixtures>Parametrize fixtures with cases</a><a class=headerlink href=#parametrize-fixtures-with-cases title="Permanent link">⚑</a></h3> <p>In some scenarios you might wish to parametrize a fixture with the cases, rather than the test function. For example:</p> <ul> <li>To inject the same test cases in several test functions without duplicating the <code>@parametrize_with_cases</code> decorator on each of them.</li> <li>To generate the test cases once for the whole session, using a <code>scope='session'</code> fixture or <a href=https://docs.pytest.org/en/stable/fixture.html#scope-sharing-a-fixture-instance-across-tests-in-a-class-module-or-session>another scope</a>.</li> <li>To modify the test cases, log some message, or perform some other action before injecting them into the test functions, and/or after executing the test function (thanks to <a href=https://docs.pytest.org/en/stable/fixture.html#fixture-finalization-executing-teardown-code>yield fixtures</a>).</li> </ul> <p>For this, simply use <code>@fixture</code> from <code>pytest_cases</code> instead of <code>@pytest.fixture</code> to define your fixture. That allows your fixtures to be easily parametrized with <code>@parametrize_with_cases</code>, <code>@parametrize</code>, and even <code>@pytest.mark.parametrize</code>.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>fixture</span><span class=p>,</span> <span class=n>parametrize_with_cases</span>

<span class=nd>@fixture</span>
<span class=nd>@parametrize_with_cases</span><span class=p>(</span><span class=s2>&quot;a,b&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>c</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span>

<span class=k>def</span> <span class=nf>test_foo</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span>
</code></pre></div> <h2 id=pytest-cases-internals><a href=https://smarie.github.io/python-pytest-cases/pytest_goodies/ >Pytest-cases internals</a><a class=headerlink href=#pytest-cases-internals title="Permanent link">⚑</a></h2> <h3 id=fixture><a href=https://smarie.github.io/python-pytest-cases/pytest_goodies/#fixture><code>@fixture</code></a><a class=headerlink href=#fixture title="Permanent link">⚑</a></h3> <p><code>@fixture</code> is similar to <code>pytest.fixture</code> but without its <code>param</code> and <code>ids</code> arguments. Instead, it is able to pick the parametrization from <code>@pytest.mark.parametrize</code> marks applied on fixtures. This makes it very intuitive for users to parametrize both their tests and fixtures.</p> <p>Finally it now supports unpacking, see <a href=#unpack_fixture-unpack_into>unpacking feature</a>.</p> <div class="admonition note"> <p class=admonition-title><code>@fixture</code> deprecation if/when <code>@pytest.fixture</code> supports <code>@pytest.mark.parametrize</code></p> <p>The ability for pytest fixtures to support the <code>@pytest.mark.parametrize</code> annotation is a feature that clearly belongs to <code>pytest</code> scope, and has been <a href=https://github.com/pytest-dev/pytest/issues/3960>requested already</a>. It is therefore expected that <code>@fixture</code> will be deprecated in favor of <code>@pytest_fixture</code> if/when the <code>pytest</code> team decides to add the proposed feature. As always, deprecation will happen slowly across versions (at least two minor, or one major version update) so as for users to have the time to update their code bases.</p> </div> <h4 id=unpack_fixture-unpack_into><a href=https://smarie.github.io/python-pytest-cases/pytest_goodies/#unpack_fixture-unpack_into><code>unpack_fixture</code> / <code>unpack_into</code></a><a class=headerlink href=#unpack_fixture-unpack_into title="Permanent link">⚑</a></h4> <p>In some cases fixtures return a tuple or a list of items. It is not easy to refer to a single of these items in a test or another fixture. With <code>unpack_fixture</code> you can easily do it:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pytest</span>
<span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>unpack_fixture</span><span class=p>,</span> <span class=n>fixture</span>

<span class=nd>@fixture</span>
<span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>parametrize</span><span class=p>(</span><span class=s2>&quot;o&quot;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=s1>&#39;world&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>c</span><span class=p>(</span><span class=n>o</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>o</span><span class=p>,</span> <span class=n>o</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

<span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>unpack_fixture</span><span class=p>(</span><span class=s2>&quot;a,b&quot;</span><span class=p>,</span> <span class=n>c</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>test_function</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>b</span>
</code></pre></div> <p>Note that you can also use the <code>unpack_into=</code> argument of <code>@fixture</code> to do the same thing:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pytest</span>
<span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>fixture</span>

<span class=nd>@fixture</span><span class=p>(</span><span class=n>unpack_into</span><span class=o>=</span><span class=s2>&quot;a,b&quot;</span><span class=p>)</span>
<span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>parametrize</span><span class=p>(</span><span class=s2>&quot;o&quot;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=s1>&#39;world&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>c</span><span class=p>(</span><span class=n>o</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>o</span><span class=p>,</span> <span class=n>o</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

<span class=k>def</span> <span class=nf>test_function</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>b</span>
</code></pre></div> <p>And it is also available in <code>fixture_union</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pytest</span>
<span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>fixture</span><span class=p>,</span> <span class=n>fixture_union</span>

<span class=nd>@fixture</span>
<span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>parametrize</span><span class=p>(</span><span class=s2>&quot;o&quot;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span> <span class=s1>&#39;world&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>c</span><span class=p>(</span><span class=n>o</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>o</span><span class=p>,</span> <span class=n>o</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

<span class=nd>@fixture</span>
<span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>parametrize</span><span class=p>(</span><span class=s2>&quot;o&quot;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;yeepee&#39;</span><span class=p>,</span> <span class=s1>&#39;yay&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>d</span><span class=p>(</span><span class=n>o</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>o</span><span class=p>,</span> <span class=n>o</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

<span class=n>fixture_union</span><span class=p>(</span><span class=s2>&quot;c_or_d&quot;</span><span class=p>,</span> <span class=p>[</span><span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>],</span> <span class=n>unpack_into</span><span class=o>=</span><span class=s2>&quot;a, b&quot;</span><span class=p>)</span>

<span class=k>def</span> <span class=nf>test_function</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>b</span>
</code></pre></div> <h4 id=param_fixtures><code>param_fixture[s]</code><a class=headerlink href=#param_fixtures title="Permanent link">⚑</a></h4> <p>If you wish to share some parameters across several fixtures and tests, it might be convenient to have a fixture representing this parameter. This is relatively easy for single parameters, but a bit harder for parameter tuples.</p> <p>The two utilities functions <code>param_fixture</code> (for a single parameter name) and <code>param_fixtures</code> (for a tuple of parameter names) handle the difficulty for you:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>pytest</span>
<span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>param_fixtures</span><span class=p>,</span> <span class=n>param_fixture</span>

<span class=c1># create a single parameter fixture</span>
<span class=n>my_parameter</span> <span class=o>=</span> <span class=n>param_fixture</span><span class=p>(</span><span class=s2>&quot;my_parameter&quot;</span><span class=p>,</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>])</span>

<span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
<span class=k>def</span> <span class=nf>fixture_uses_param</span><span class=p>(</span><span class=n>my_parameter</span><span class=p>):</span>
    <span class=o>...</span>

<span class=k>def</span> <span class=nf>test_uses_param</span><span class=p>(</span><span class=n>my_parameter</span><span class=p>,</span> <span class=n>fixture_uses_param</span><span class=p>):</span>
    <span class=o>...</span>

<span class=c1># -----</span>
<span class=c1># create a 2-tuple parameter fixture</span>
<span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span> <span class=o>=</span> <span class=n>param_fixtures</span><span class=p>(</span><span class=s2>&quot;arg1, arg2&quot;</span><span class=p>,</span> <span class=p>[(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>)])</span>

<span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
<span class=k>def</span> <span class=nf>fixture_uses_param2</span><span class=p>(</span><span class=n>arg2</span><span class=p>):</span>
    <span class=o>...</span>

<span class=k>def</span> <span class=nf>test_uses_param2</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>,</span> <span class=n>fixture_uses_param2</span><span class=p>):</span>
    <span class=o>...</span>
</code></pre></div> <h4 id=fixture_union><code>fixture_union</code><a class=headerlink href=#fixture_union title="Permanent link">⚑</a></h4> <p>As of <code>pytest</code> 5, it is not possible to create a "union" fixture, i.e. a parametrized fixture that would first take all the possible values of fixture A, then all possible values of fixture B, etc. Indeed all fixture dependencies of each test node are grouped together, and if they have parameters a big "cross-product" of the parameters is done by <code>pytest</code>.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pytest_cases</span> <span class=kn>import</span> <span class=n>fixture</span><span class=p>,</span> <span class=n>fixture_union</span>

<span class=nd>@fixture</span>
<span class=k>def</span> <span class=nf>first</span><span class=p>():</span>
    <span class=k>return</span> <span class=s1>&#39;hello&#39;</span>

<span class=nd>@fixture</span><span class=p>(</span><span class=n>params</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>])</span>
<span class=k>def</span> <span class=nf>second</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>request</span><span class=o>.</span><span class=n>param</span>

<span class=c1># c will first take all the values of &#39;first&#39;, then all of &#39;second&#39;</span>
<span class=n>c</span> <span class=o>=</span> <span class=n>fixture_union</span><span class=p>(</span><span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=p>[</span><span class=n>first</span><span class=p>,</span> <span class=n>second</span><span class=p>])</span>

<span class=k>def</span> <span class=nf>test_basic_union</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</code></pre></div> <p>yields</p> <div class=highlight><pre><span></span><code>&lt;...&gt;::test_basic_union[c_is_first] hello   PASSED
&lt;...&gt;::test_basic_union[c_is_second-a] a    PASSED
&lt;...&gt;::test_basic_union[c_is_second-b] b    PASSED
</code></pre></div> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">⚑</a></h2> <ul> <li><a href=https://smarie.github.io/python-pytest-cases/ >Docs</a></li> <li><a href=https://github.com/smarie/python-pytest-cases/ >Git</a></li> </ul> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-03-23T23:06:18+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-03-23</span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/nullniverse target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.footer", "navigation.instant", "navigation.top", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.220ee61c.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>