<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My personal digital garden"><meta name=author content=nullniverse><link href=https://memo.nullniverse.xyz/authentik/ rel=canonical><link href=../devops/prometheus/prometheus_troubleshooting/ rel=prev><link href=../ombi/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-9.1.21"><title>Authentik - My Memo</title><link rel=stylesheet href=../assets/stylesheets/main.eebd395e.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ecc896b0.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#installation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> You can find my posts on my <a href=https://blog.nullniverse.xyz/ ><strong>Blog</strong></a> <img src=img/blog_icon.png height=15 width=15> </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="My Memo" class="md-header__button md-logo" aria-label="My Memo" data-md-component=logo> <img src=../img/favicon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> My Memo </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Authentik </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/nullniverse/memo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nullniverse/memo </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="My Memo" class="md-nav__button md-logo" aria-label="My Memo" data-md-component=logo> <img src=../img/favicon.png alt=logo> </a> My Memo </label> <div class=md-nav__source> <a href=https://github.com/nullniverse/memo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nullniverse/memo </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../contact/ class=md-nav__link> Contact </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__link--index "> <a href=../devops/devops/ >DevOps</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> DevOps </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> Infrastructure as Code <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Infrastructure as Code </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gitea/ class=md-nav__link> Gitea </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/helm/helm/ >Helm</a> <label for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/helm/helm_installation/ class=md-nav__link> Helm Installation </a> </li> <li class=md-nav__item> <a href=../devops/helm/helm_commands/ class=md-nav__link> Helm Commands </a> </li> <li class=md-nav__item> <a href=../devops/helm/helm_secrets/ class=md-nav__link> Helm Secrets </a> </li> <li class=md-nav__item> <a href=../helm_git/ class=md-nav__link> Helm Git </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/helmfile/ class=md-nav__link> Helmfile </a> </li> <li class=md-nav__item> <a href=../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../ansible_snippets/ class=md-nav__link> Ansible Snippets </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_6> <div class="md-nav__link md-nav__link--index "> <a href=../dotfiles/ >Dotfiles</a> <label for=__nav_3_1_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_6> <span class="md-nav__icon md-icon"></span> Dotfiles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chezmoi/ class=md-nav__link> Chezmoi </a> </li> <li class=md-nav__item> <a href=../dotdrop/ class=md-nav__link> Dotdrop </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> Infrastructure Solutions <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Infrastructure Solutions </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubernetes/kubernetes/ >Kubernetes</a> <label for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_architecture/ class=md-nav__link> Architecture </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_2> <label class=md-nav__link for=__nav_3_2_1_2 id=__nav_3_2_1_2_label tabindex=0> Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_2> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_namespaces/ class=md-nav__link> Namespaces </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_pods/ class=md-nav__link> Pods </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_replicasets/ class=md-nav__link> ReplicaSets </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_deployments/ class=md-nav__link> Deployments </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_volumes/ class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_services/ class=md-nav__link> Services </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_labels/ class=md-nav__link> Labels </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_annotations/ class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_ingress/ class=md-nav__link> Ingress </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_operators/ class=md-nav__link> Operators </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_jobs/ class=md-nav__link> Jobs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubectl/kubectl/ >Kubectl</a> <label for=__nav_3_2_1_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_3> <span class="md-nav__icon md-icon"></span> Kubectl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubectl/kubectl_installation/ class=md-nav__link> Kubectl Installation </a> </li> <li class=md-nav__item> <a href=../devops/kubectl/kubectl_commands/ class=md-nav__link> Kubectl Commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_4> <label class=md-nav__link for=__nav_3_2_1_4 id=__nav_3_2_1_4_label tabindex=0> Additional Components <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_4> <span class="md-nav__icon md-icon"></span> Additional Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_metric_server/ class=md-nav__link> Metrics Server </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_ingress_controller/ class=md-nav__link> Ingress Controller </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_external_dns/ class=md-nav__link> External DNS </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_cluster_autoscaler/ class=md-nav__link> Cluster Autoscaler </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_dashboard/ class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_storage_driver/ class=md-nav__link> Storage Driver </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_vertical_pod_autoscaler/ class=md-nav__link> Vertical Pod Autoscaler </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_networking/ class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../kubernetes_debugging/ class=md-nav__link> Debugging </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_7> <label class=md-nav__link for=__nav_3_2_1_7 id=__nav_3_2_1_7_label tabindex=0> Backups <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_7> <span class="md-nav__icon md-icon"></span> Backups </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../velero/ class=md-nav__link> Velero </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_8> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubernetes/kubernetes_tools/ >Tools</a> <label for=__nav_3_2_1_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_8> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../krew/ class=md-nav__link> Krew </a> </li> <li class=md-nav__item> <a href=../ksniff/ class=md-nav__link> Ksniff </a> </li> <li class=md-nav__item> <a href=../mizu/ class=md-nav__link> Mizu </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/aws/aws/ >AWS</a> <label for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws_snippets/ class=md-nav__link> AWS Snippets </a> </li> <li class=md-nav__item> <a href=../aws_savings_plan/ class=md-nav__link> AWS Savings plan </a> </li> <li class=md-nav__item> <a href=../devops/aws/security_groups/ class=md-nav__link> Security groups workflow </a> </li> <li class=md-nav__item> <a href=../devops/aws/eks/ class=md-nav__link> EKS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2_5> <div class="md-nav__link md-nav__link--index "> <a href=../devops/aws/iam/iam/ >IAM</a> <label for=__nav_3_2_2_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2_5> <span class="md-nav__icon md-icon"></span> IAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/aws/iam/iam_commands/ class=md-nav__link> IAM Commands </a> </li> <li class=md-nav__item> <a href=../devops/aws/iam/iam_debug/ class=md-nav__link> IAM Debugging </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/aws/s3/ class=md-nav__link> S3 </a> </li> <li class=md-nav__item> <a href=../aws_waf/ class=md-nav__link> WAF </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/ci/ >Continuous Integration</a> <label for=__nav_3_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Continuous Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../drone/ class=md-nav__link> Drone </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_2> <label class=md-nav__link for=__nav_3_3_2 id=__nav_3_3_2_label tabindex=0> Linters <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Linters </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/alex/ class=md-nav__link> Alex </a> </li> <li class=md-nav__item> <a href=../flakeheaven/ class=md-nav__link> Flakeheaven </a> </li> <li class=md-nav__item> <a href=../devops/flake8/ class=md-nav__link> Flake8 </a> </li> <li class=md-nav__item> <a href=../devops/markdownlint/ class=md-nav__link> Markdownlint </a> </li> <li class=md-nav__item> <a href=../devops/proselint/ class=md-nav__link> Proselint </a> </li> <li class=md-nav__item> <a href=../devops/yamllint/ class=md-nav__link> Yamllint </a> </li> <li class=md-nav__item> <a href=../devops/write_good/ class=md-nav__link> Write Good </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_3> <label class=md-nav__link for=__nav_3_3_3 id=__nav_3_3_3_label tabindex=0> Formatters/Fixers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_3> <span class="md-nav__icon md-icon"></span> Formatters/Fixers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/black/ class=md-nav__link> Black </a> </li> <li class=md-nav__item> <a href=../yamlfix/ class=md-nav__link> Yamlfix </a> </li> <li class=md-nav__item> <a href=../pyment/ class=md-nav__link> Pyment </a> </li> <li class=md-nav__item> <a href=../mdformat/ class=md-nav__link> mdformat </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_4> <label class=md-nav__link for=__nav_3_3_4 id=__nav_3_3_4_label tabindex=0> Type Checkers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_4> <span class="md-nav__icon md-icon"></span> Type Checkers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/mypy/ class=md-nav__link> Mypy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_5> <label class=md-nav__link for=__nav_3_3_5 id=__nav_3_3_5_label tabindex=0> Security Checkers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_5> <span class="md-nav__icon md-icon"></span> Security Checkers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/safety/ class=md-nav__link> Safety </a> </li> <li class=md-nav__item> <a href=../devops/bandit/ class=md-nav__link> Bandit </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_6> <label class=md-nav__link for=__nav_3_3_6 id=__nav_3_3_6_label tabindex=0> Dependency managers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_6> <span class="md-nav__icon md-icon"></span> Dependency managers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/pip_tools/ class=md-nav__link> Pip-tools </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> Automating Processes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Automating Processes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../linux/cookiecutter/ class=md-nav__link> cookiecutter </a> </li> <li class=md-nav__item> <a href=../linux/cruft/ class=md-nav__link> cruft </a> </li> <li class=md-nav__item> <a href=../renovate/ class=md-nav__link> renovate </a> </li> <li class=md-nav__item> <a href=../letsencrypt/ class=md-nav__link> letsencrypt </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <div class="md-nav__link md-nav__link--index "> <a href=../storage/ >Storage</a> <label for=__nav_3_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_1> <div class="md-nav__link md-nav__link--index "> <a href=../linux/zfs/ >OpenZFS</a> <label for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> OpenZFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../zfs_storage_planning/ class=md-nav__link> OpenZFS storage planning </a> </li> <li class=md-nav__item> <a href=../sanoid/ class=md-nav__link> Sanoid </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../monitoring_comparison/ class=md-nav__link> Monitoring Comparison </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/prometheus/prometheus/ >Prometheus</a> <label for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> Prometheus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_architecture/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_operator/ class=md-nav__link> Prometheus Operator </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_installation/ class=md-nav__link> Prometheus Install </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/alertmanager/ class=md-nav__link> AlertManager </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/blackbox_exporter/ class=md-nav__link> Blackbox Exporter </a> </li> <li class=md-nav__item> <a href=../elasticsearch_exporter/ class=md-nav__link> Elasticsearch Exporter </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/node_exporter/ class=md-nav__link> Node Exporter </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/instance_sizing_analysis/ class=md-nav__link> Instance sizing analysis </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_troubleshooting/ class=md-nav__link> Prometheus Troubleshooting </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7 checked> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> Authentication <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=true> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Authentication </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Authentik <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Authentik </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#terraform class=md-nav__link> Terraform </a> <nav class=md-nav aria-label=Terraform> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-the-provider class=md-nav__link> Configure the provider </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-some-common-applications class=md-nav__link> Configure some common applications </a> </li> <li class=md-nav__item> <a href=#gitea class=md-nav__link> Gitea </a> </li> <li class=md-nav__item> <a href=#configure-the-invitation-flow class=md-nav__link> Configure the invitation flow </a> </li> <li class=md-nav__item> <a href=#configure-password-recovery class=md-nav__link> Configure password recovery </a> </li> <li class=md-nav__item> <a href=#use-blueprints class=md-nav__link> Use blueprints </a> <nav class=md-nav aria-label="Use blueprints"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#export-blueprints class=md-nav__link> Export blueprints </a> <nav class=md-nav aria-label="Export blueprints"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#global-export class=md-nav__link> Global export </a> </li> <li class=md-nav__item> <a href=#flow-export class=md-nav__link> Flow export </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hide-and-application-from-a-user class=md-nav__link> Hide and application from a user </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex=0> Self-hosted services <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Self-hosted services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ombi/ class=md-nav__link> Ombi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <div class="md-nav__link md-nav__link--index "> <a href=../devops/api_management/ >API Management</a> <label for=__nav_3_9> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> API Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kong/kong/ class=md-nav__link> Kong </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <div class="md-nav__link md-nav__link--index "> <a href=../language/language/ >Language Learning</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Language Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../language/chinese/chinese/ class=md-nav__link> Chinese </a> </li> <li class=md-nav__item> <a href=../language/russian/russian/ class=md-nav__link> Russian </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#terraform class=md-nav__link> Terraform </a> <nav class=md-nav aria-label=Terraform> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-the-provider class=md-nav__link> Configure the provider </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-some-common-applications class=md-nav__link> Configure some common applications </a> </li> <li class=md-nav__item> <a href=#gitea class=md-nav__link> Gitea </a> </li> <li class=md-nav__item> <a href=#configure-the-invitation-flow class=md-nav__link> Configure the invitation flow </a> </li> <li class=md-nav__item> <a href=#configure-password-recovery class=md-nav__link> Configure password recovery </a> </li> <li class=md-nav__item> <a href=#use-blueprints class=md-nav__link> Use blueprints </a> <nav class=md-nav aria-label="Use blueprints"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#export-blueprints class=md-nav__link> Export blueprints </a> <nav class=md-nav aria-label="Export blueprints"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#global-export class=md-nav__link> Global export </a> </li> <li class=md-nav__item> <a href=#flow-export class=md-nav__link> Flow export </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hide-and-application-from-a-user class=md-nav__link> Hide and application from a user </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Authentik</h1> <p><a href=https://goauthentik.io/ >Authentik</a> is an open-source Identity Provider focused on flexibility and versatility.</p> <p>What I like:</p> <ul> <li>Is maintained and popular</li> <li>It has a clean interface</li> <li>They have their own <a href=https://registry.terraform.io/providers/goauthentik/authentik/latest/docs/resources/application>terraform provider</a> Oo!</li> </ul> <p>What I don't like:</p> <ul> <li> <p>It's heavy focused on GUI interaction, but you can export the configuration to YAML files to be applied without the GUI interaction.</p> </li> <li> <p>The documentation is oriented to developers and not users. It's a little difficult to get a grasp on how to do things in the platform without following blog posts.</p> </li> </ul> <h2 id=installation><a href=https://goauthentik.io/docs/installation>Installation</a><a class=headerlink href=#installation title="Permanent link">⚑</a></h2> <p>You can install it with Kubernetes or with <code>docker-compose</code>. I'm going to do the second.</p> <p>Download the latest <code>docker-compose.yml</code> from <a href=https://goauthentik.io/docker-compose.yml>here</a>. Place it in a directory of your choice.</p> <p>If this is a fresh authentik install run the following commands to generate a password:</p> <div class=highlight><pre><span></span><code><span class=c1># You can also use openssl instead: `openssl rand -base64 36`</span>
sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>pwgen
<span class=c1># Because of a PostgreSQL limitation, only passwords up to 99 chars are supported</span>
<span class=c1># See https://www.postgresql.org/message-id/09512C4F-8CB9-4021-B455-EF4C4F0D55A0@amazon.com</span>
<span class=nb>echo</span><span class=w> </span><span class=s2>&quot;PG_PASS=</span><span class=k>$(</span>pwgen<span class=w> </span>-s<span class=w> </span><span class=m>40</span><span class=w> </span><span class=m>1</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>.env
<span class=nb>echo</span><span class=w> </span><span class=s2>&quot;AUTHENTIK_SECRET_KEY=</span><span class=k>$(</span>pwgen<span class=w> </span>-s<span class=w> </span><span class=m>50</span><span class=w> </span><span class=m>1</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>.env
</code></pre></div> <p>It is also recommended to configure global email credentials. These are used by authentik to notify you about alerts and configuration issues. They can also be used by Email stages to send verification/recovery emails.</p> <p>Append this block to your .env file</p> <div class=highlight><pre><span></span><code><span class=c1># SMTP Host Emails are sent to</span>
<span class=nv>AUTHENTIK_EMAIL__HOST</span><span class=o>=</span>localhost
<span class=nv>AUTHENTIK_EMAIL__PORT</span><span class=o>=</span><span class=m>25</span>
<span class=c1># Optionally authenticate (don&#39;t add quotation marks to your password)</span>
<span class=nv>AUTHENTIK_EMAIL__USERNAME</span><span class=o>=</span>
<span class=nv>AUTHENTIK_EMAIL__PASSWORD</span><span class=o>=</span>
<span class=c1># Use StartTLS</span>
<span class=nv>AUTHENTIK_EMAIL__USE_TLS</span><span class=o>=</span><span class=nb>false</span>
<span class=c1># Use SSL</span>
<span class=nv>AUTHENTIK_EMAIL__USE_SSL</span><span class=o>=</span><span class=nb>false</span>
<span class=nv>AUTHENTIK_EMAIL__TIMEOUT</span><span class=o>=</span><span class=m>10</span>
<span class=c1># Email address authentik will send from, should have a correct @domain</span>
<span class=nv>AUTHENTIK_EMAIL__FROM</span><span class=o>=</span>authentik@localhost
</code></pre></div> <p>By default, authentik listens on port 9000 for HTTP and 9443 for HTTPS. To change this, you can set the following variables in .env:</p> <div class=highlight><pre><span></span><code><span class=nv>AUTHENTIK_PORT_HTTP</span><span class=o>=</span><span class=m>80</span>
<span class=nv>AUTHENTIK_PORT_HTTPS</span><span class=o>=</span><span class=m>443</span>
</code></pre></div> <p>You may need to tweak the <code>volumes</code> and the <code>networks</code> sections of the <code>docker-compose.yml</code> to your liking.</p> <p>Once everything is set you can run <code>docker-compose up</code> to test everything is working.</p> <p>In your browser, navigate to authentik’s initial setup page <a href=https://auth.home.yourdomain.com/if/flow/initial-setup/ >https://auth.home.yourdomain.com/if/flow/initial-setup/</a>.</p> <p>Set the email and password for the default admin user, <code>akadmin</code>. You’re now logged in.</p> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">⚑</a></h2> <h3 id=terraform><a href=https://registry.terraform.io/providers/goauthentik/authentik/latest/docs>Terraform</a><a class=headerlink href=#terraform title="Permanent link">⚑</a></h3> <p>You can use <a href=../terraform/ ><code>terraform</code></a> to configure authentik! <code>&lt;3</code>.</p> <h4 id=configure-the-provider><a href=https://registry.terraform.io/providers/goauthentik/authentik/latest/docs#configure-provider-with-environment-variables>Configure the provider</a><a class=headerlink href=#configure-the-provider title="Permanent link">⚑</a></h4> <p>To configure the provider you need to specify the url and an Authentik API token, keeping in mind that whoever gets access to this information will have access and full permissions on your Authentik instance it's critical that <a href=../terraform/#sensitive-information>you store this information well</a>. We'll use <a href=#sensitive-information-in-the-terraform-source-code><code>sops</code> to encrypt the token with GPG.</a>.</p> <p>First create an Authentik user under <code>Admin interface/Directory/Users</code> with the next attributes:</p> <ul> <li>Username: <code>terraform</code></li> <li>Name: <code>Terraform</code></li> <li>Path: <code>infra</code></li> <li>Groups: <code>Admin</code></li> </ul> <p>Then create a token with name <code>Terraform</code> under <code>Directory/Tokens &amp; App passwords</code>, copy it to your clipboard.</p> <p>Configure <code>sops</code> by defining the gpg keys in a <code>.sops.yaml</code> file at the top of your repository:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>creation_rules</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pgp</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;-</span>
<span class=w>      </span><span class=no>2829BASDFHWEGWG23WDSLKGL323534J35LKWERQS,</span>
<span class=w>      </span><span class=no>2GEFDBW349YHEDOH2T0GE9RH0NEORIG342RFSLHH</span>
</code></pre></div> <p>Then create the secrets file with the command <code>sops secrets.enc.json</code> somewhere in your terraform repository. For example:</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;authentik_token&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;paste the token here&quot;</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code>terraform {
  required_providers {
    authentik = {
      source = &quot;goauthentik/authentik&quot;
      version = &quot;~&gt; 2023.1.1&quot;
    }
    sops = {
      source = &quot;carlpett/sops&quot;
      version = &quot;~&gt; 0.5&quot;
    }
  }
}

provider &quot;authentik&quot; {
  url   = &quot;https://oauth.your-domain.org&quot;
  token = data.sops_file.secrets.data[&quot;authentik_token&quot;]
}
</code></pre></div> <h3 id=configure-some-common-applications><a href=https://goauthentik.io/integrations/ >Configure some common applications</a><a class=headerlink href=#configure-some-common-applications title="Permanent link">⚑</a></h3> <p>You have some guides to connect <a href=https://goauthentik.io/integrations/ >some popular applications</a></p> <h3 id=gitea><a href=https://goauthentik.io/integrations/services/gitea/ >Gitea</a><a class=headerlink href=#gitea title="Permanent link">⚑</a></h3> <p>You can follow the <a href=https://goauthentik.io/integrations/services/gitea/ >Authentik Gitea docs</a> or you can use the next terraform snippet:</p> <div class=highlight><pre><span></span><code># ----------------
# --    Data    --
# ----------------

data &quot;authentik_flow&quot; &quot;default-authorization-flow&quot; {
  slug = &quot;default-provider-authorization-implicit-consent&quot;
}

# -----------------------
# --    Application    --
# -----------------------

resource &quot;authentik_application&quot; &quot;gitea&quot; {
  name              = &quot;Gitea&quot;
  slug              = &quot;gitea&quot;
  protocol_provider = authentik_provider_oauth2.gitea.id
  meta_icon = &quot;application-icons/gitea.svg&quot;
  lifecycle {
    ignore_changes = [
      # The terraform provider is continuously changing the attribute even though it&#39;s set
      meta_icon,
    ]
  }
}

# --------------------------
# --    Oauth provider    --
# --------------------------

resource &quot;authentik_provider_oauth2&quot; &quot;gitea&quot; {
  name               = &quot;Gitea&quot;
  client_id = &quot;gitea&quot;
  authorization_flow = data.authentik_flow.default-authorization-flow.id
  property_mappings = [
    authentik_scope_mapping.gitea.id,
    data.authentik_scope_mapping.email.id,
    data.authentik_scope_mapping.openid.id,
    data.authentik_scope_mapping.profile.id,
  ]
  redirect_uris = [
    &quot;https://git.your-domain.org/user/oauth2/authentik/callback&quot;,
  ]
  signing_key = data.authentik_certificate_key_pair.default.id
}

data &quot;authentik_certificate_key_pair&quot; &quot;default&quot; {
  name = &quot;authentik Self-signed Certificate&quot;
}

# -------------------------
# --    Scope mapping    --
# -------------------------

resource &quot;authentik_scope_mapping&quot; &quot;gitea&quot; {
  name       = &quot;Gitea&quot;
  scope_name = &quot;gitea&quot;
  expression = &lt;&lt;EOF
gitea_claims = {}
if request.user.ak_groups.filter(name=&quot;Users&quot;).exists():
    gitea_claims[&quot;gitea&quot;]= &quot;user&quot;
if request.user.ak_groups.filter(name=&quot;Admins&quot;).exists():
    gitea_claims[&quot;gitea&quot;]= &quot;admin&quot;

return gitea_claims
EOF
}

data &quot;authentik_scope_mapping&quot; &quot;email&quot; {
  managed = &quot;goauthentik.io/providers/oauth2/scope-email&quot;
}

data &quot;authentik_scope_mapping&quot; &quot;openid&quot; {
  managed = &quot;goauthentik.io/providers/oauth2/scope-openid&quot;
}

data &quot;authentik_scope_mapping&quot; &quot;profile&quot; {
  managed = &quot;goauthentik.io/providers/oauth2/scope-profile&quot;
}

# -------------------
# --    Outputs    --
# -------------------

output &quot;gitea_oauth_id&quot; {
  value = authentik_provider_oauth2.gitea.client_id
}

output &quot;gitea_oauth_secret&quot; {
  value = authentik_provider_oauth2.gitea.client_secret
}
</code></pre></div> <p>It assumes that:</p> <ul> <li>You've changed <code>git.your-domain.org</code> with your gitea domain.</li> <li>The gitea logo is mounted in the docker directory <code>/media/application-icons/gitea.svg</code>.</li> </ul> <p>Gitea can be configured through terraform too. There is an <a href=https://gitea.com/gitea/terraform-provider-gitea/src/branch/main>official provider</a> that doesn't work, there's a [fork that does though[(<a href=https://registry.terraform.io/providers/Lerentis/gitea/latest/docs>https://registry.terraform.io/providers/Lerentis/gitea/latest/docs</a>). Sadly it doesn't yet support configuring Oauth Authentication sources. So you'll need to configure it manually.</p> <p>Be careful <a href=https://registry.terraform.io/providers/Lerentis/gitea/latest/docs/resources/oauth2_app><code>gitea_oauth2_app</code></a> looks to be the right resource to do that, but instead it configures Gitea to be the Oauth provider, not a consumer.</p> <h3 id=configure-the-invitation-flow><a href="https://yewtu.be/watch?v=mGOTpRfulfQ">Configure the invitation flow</a><a class=headerlink href=#configure-the-invitation-flow title="Permanent link">⚑</a></h3> <p>Let's assume that we have two groups (Admins and Users) created under <code>Directory/Groups</code> and that we want to configure an invitation link for a user to be added directly on the <code>Admins</code> group.</p> <p>Authentik works by defining Stages and Flows. Stages are the steps you need to follow to complete a procedure, and a flow is the procedure itself.</p> <p>You create Stages by: * Going to the Admin interface * Going to Flows &amp; Stages/Stages * Click on Create</p> <p>To be able to complete the invitation through link we need to define the next stages:</p> <ul> <li> <p>An Invitation Stage: This stage represents the moment an admin chooses to create an invitation for a user. Graphically you would need to:</p> </li> <li> <p>Click on Create</p> </li> <li>Select Invitation Stage</li> <li>Fill the form with the next data:<ul> <li>Name: enrollment-invitation</li> <li>Uncheck the <code>Continue flow without invitation</code> as we don't want users to be able to register without the invitation.</li> </ul> </li> <li>Click Finish</li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_invitation&quot;</span><span class=w> </span><span class=nv>&quot;default&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>                             </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;enrollment-invitation&quot;</span>
<span class=w>  </span><span class=na>continue_flow_without_invitation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
<span class=p>}</span>
</code></pre></div> <ul> <li> <p>An User Write Stage: This is when the user will be created but it won't show up as the username and password are not yet selected. Graphically you would need to:</p> <ul> <li>Click on Create</li> <li>Select User Write Stage</li> <li>Click on Next</li> <li>Fill the form with the next data:</li> <li>Name: enrollment-invitation-admin-write</li> <li>Enable the <code>Can Create Users</code> flag.</li> <li>If you want users to validate their email leave "Create users as inactive" enabled, otherwise disable it.</li> <li>Select the group you want the user to be added to. I don't <a href=https://github.com/goauthentik/authentik/issues/2098>yet know how to select more than one group</a></li> <li>Click on Finish</li> </ul> </li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_user_write&quot;</span><span class=w> </span><span class=nv>&quot;admin_write&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>                     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;enrollment-invitation-admin-write&quot;</span>
<span class=w>  </span><span class=na>create_users_as_inactive</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=w>  </span><span class=na>create_users_group</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_group.admins.id</span>
<span class=p>}</span>
</code></pre></div> <p>Where <code>authentik_group.admin</code> is defined as:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_group&quot;</span><span class=w> </span><span class=nv>&quot;admins&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Admins&quot;</span>
<span class=w>  </span><span class=na>is_superuser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=w>  </span><span class=na>users</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=nv>data.authentik_user.user_1.id</span><span class=p>,</span>
<span class=w>    </span><span class=nv>data.authentik_user.user_2.id</span><span class=p>,</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>

<span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_user&quot;</span><span class=w> </span><span class=nv>&quot;user_1&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;user_1&quot;</span>
<span class=p>}</span>

<span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_user&quot;</span><span class=w> </span><span class=nv>&quot;user_2&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;user_2&quot;</span>
<span class=p>}</span>
</code></pre></div> <ul> <li>Email Confirmation Stage: This is when the user gets an email to confirm that it has access to it</li> </ul> <p>Graphically you would need to:</p> <ul> <li>Click on Create</li> <li>Select Email Stage</li> <li>Click on Next<ul> <li>Name: email-account-confirmation</li> <li>Subject: Account confirmation</li> <li>Template: Account confirmation</li> </ul> </li> <li>Click on Finish</li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_email&quot;</span><span class=w> </span><span class=nv>&quot;account_confirmation&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>                     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;email-account-confirmation&quot;</span>
<span class=w>  </span><span class=na>activate_user_on_success</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=w>  </span><span class=na>subject</span><span class=w>                  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Authentik Account Confirmation&quot;</span>
<span class=w>  </span><span class=na>template</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;email/account_confirmation.html&quot;</span>
<span class=w>  </span><span class=na>timeout</span><span class=w>                  </span><span class=o>=</span><span class=w> </span><span class=m>10</span>
<span class=p>}</span>
</code></pre></div> <p>Create the invitation Flow:</p> <p>Graphically you would need to:</p> <ul> <li>Go to <code>Flows &amp; Stages/Flows</code></li> <li>Click on Create</li> <li>Fill the form with the next data:<ul> <li>Name: Enrollment Invitation Admin</li> <li>Title: Enrollment Invitation Admin</li> <li>Designation: Enrollment</li> <li>Unfold the Behavior settings to enable the Compatibility mode</li> </ul> </li> <li>Click Create</li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow&quot;</span><span class=w> </span><span class=nv>&quot;enrollment_admin&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Enrollment invitation admin&quot;</span>
<span class=w>  </span><span class=na>title</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Enrollment invitation admin&quot;</span>
<span class=w>  </span><span class=na>slug</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;enrollment-invitation-admin&quot;</span>
<span class=w>  </span><span class=na>designation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;enrollment&quot;</span>
<span class=p>}</span>
</code></pre></div> <p>We need to define how the flow is going to behave by adding the different the stage bindings:</p> <ul> <li>Bind the Invitation admin stage:</li> </ul> <p>Graphically you would need to:</p> <ul> <li>Click on the flow we just created <code>enrollment-invitation-admin</code></li> <li>Click on <code>Stage Bindings</code></li> <li>Click on <code>Bind Stage</code></li> <li>Fill the form with the next data:<ul> <li>Stage: select <code>enrollment-invitation-admin</code></li> <li>Order: 10</li> </ul> </li> <li>Click Create</li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;invitation_creation&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.enrollment_admin.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_stage_invitation.default.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>10</span>
<span class=p>}</span>
</code></pre></div> <ul> <li>Bind the Enrollment prompt stage: This is a builtin stage where the user is asked for their login information</li> </ul> <p>Graphically you would need to:</p> <ul> <li>Click on <code>Bind Stage</code></li> <li>Fill the form with the next data:<ul> <li>Stage: select <code>default-source-enrollment-prompt</code></li> <li>Order: 20</li> </ul> </li> <li>Click Create</li> <li>Click Edit Stage and configure it wit:<ul> <li>On the fields select: </li> <li>username</li> <li>name</li> <li>email</li> <li>password</li> <li>password_repeat</li> <li>Select the validation policy you have one</li> </ul> </li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_prompt&quot;</span><span class=w> </span><span class=nv>&quot;user_data&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;enrollment-user-data-prompt&quot;</span>
<span class=w>  </span><span class=na>fields</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=w> </span>
<span class=w>      </span><span class=nv>authentik_stage_prompt_field.username.id</span><span class=p>,</span>
<span class=w>      </span><span class=nv>authentik_stage_prompt_field.name.id</span><span class=p>,</span>
<span class=w>      </span><span class=nv>authentik_stage_prompt_field.email.id</span><span class=p>,</span>
<span class=w>      </span><span class=nv>authentik_stage_prompt_field.password.id</span><span class=p>,</span>
<span class=w>      </span><span class=nv>authentik_stage_prompt_field.password_repeat.id</span><span class=p>,</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_prompt_field&quot;</span><span class=w> </span><span class=nv>&quot;username&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>field_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;username&quot;</span>
<span class=w>  </span><span class=na>label</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Username&quot;</span>
<span class=w>  </span><span class=na>type</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;text&quot;</span>
<span class=w>  </span><span class=na>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>200</span>
<span class=w>  </span><span class=na>placeholder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=dl>EOT</span>
<span class=sh>try:</span>
<span class=sh>    return user.username</span>
<span class=sh>except:</span>
<span class=sh>    return &#39;&#39;</span>
<span class=dl>EOT</span>
<span class=w>  </span><span class=na>placeholder_expression</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=w>  </span><span class=na>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_prompt_field&quot;</span><span class=w> </span><span class=nv>&quot;name&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>field_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;name&quot;</span>
<span class=w>  </span><span class=na>label</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Name&quot;</span>
<span class=w>  </span><span class=na>type</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;text&quot;</span>
<span class=w>  </span><span class=na>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>201</span>
<span class=w>  </span><span class=na>placeholder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=dl>EOT</span>
<span class=sh>try:</span>
<span class=sh>    return user.name</span>
<span class=sh>except:</span>
<span class=sh>    return &#39;&#39;</span>
<span class=dl>EOT</span>
<span class=w>  </span><span class=na>placeholder_expression</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=w>  </span><span class=na>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_prompt_field&quot;</span><span class=w> </span><span class=nv>&quot;email&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>field_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;email&quot;</span>
<span class=w>  </span><span class=na>label</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Email&quot;</span>
<span class=w>  </span><span class=na>type</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;email&quot;</span>
<span class=w>  </span><span class=na>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>202</span>
<span class=w>  </span><span class=na>placeholder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=dl>EOT</span>
<span class=sh>try:</span>
<span class=sh>    return user.email</span>
<span class=sh>except:</span>
<span class=sh>    return &#39;&#39;</span>
<span class=dl>EOT</span>
<span class=w>  </span><span class=na>placeholder_expression</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=w>  </span><span class=na>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_prompt_field&quot;</span><span class=w> </span><span class=nv>&quot;password&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>field_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;password&quot;</span>
<span class=w>  </span><span class=na>label</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Password&quot;</span>
<span class=w>  </span><span class=na>type</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;password&quot;</span>
<span class=w>  </span><span class=na>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>300</span>
<span class=w>  </span><span class=na>placeholder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Password&quot;</span>
<span class=w>  </span><span class=na>placeholder_expression</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
<span class=w>  </span><span class=na>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_prompt_field&quot;</span><span class=w> </span><span class=nv>&quot;password_repeat&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>field_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;password_repeat&quot;</span>
<span class=w>  </span><span class=na>label</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Password (repeat)&quot;</span>
<span class=w>  </span><span class=na>type</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;password&quot;</span>
<span class=w>  </span><span class=na>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>301</span>
<span class=w>  </span><span class=na>placeholder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Password (repeat)&quot;</span>
<span class=w>  </span><span class=na>placeholder_expression</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
<span class=w>  </span><span class=na>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=p>}</span>
</code></pre></div> <p>We had to redefine all the <code>authentik_stage_prompt_field</code> because the terraform provider doesn't yet support <a href=https://github.com/goauthentik/terraform-provider-authentik/issues/243>the <code>data</code> resource of the <code>authentik_stage_prompt_field</code></a></p> <ul> <li>Bind the User write stage:</li> </ul> <p>Graphically you would need to:</p> <ul> <li>Click on <code>Bind Stage</code></li> <li>Fill the form with the next data:<ul> <li>Stage: select <code>enrollment-invitation-admin-write</code></li> <li>Order: 30</li> </ul> </li> <li>Click Create</li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;invitation_user_write&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.enrollment_admin.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_stage_user_write.admin_write.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>30</span>
<span class=p>}</span>
</code></pre></div> <ul> <li>Bind the email account confirmation stage: </li> </ul> <p>Graphically you would need to:</p> <ul> <li>Click on <code>Bind Stage</code></li> <li>Fill the form with the next data:<ul> <li>Stage: select <code>email-account-confirmation</code></li> <li>Order: 40</li> </ul> </li> <li>Click Create</li> <li>Edit the stage and make sure that you have enabled:<ul> <li>Activate pending user on success</li> <li>Use global settings</li> </ul> </li> <li>Click Update</li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;invitation_account_confirmation&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.enrollment_admin.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_stage_email.account_confirmation.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>40</span>
<span class=p>}</span>
</code></pre></div> <ul> <li>Bind the User login stage: This is a builtin stage where the user is asked to log in</li> </ul> <p>Graphically you would need to:</p> <ul> <li>Click on <code>Bind Stage</code></li> <li>Fill the form with the next data:<ul> <li>Stage: select <code>default-source-enrollment-login</code></li> <li>Order: 50</li> </ul> </li> <li>Click Create</li> </ul> <p>Or use the next terraform snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;invitation_login&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.enrollment_admin.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>data.authentik_stage.default_source_enrollment_login.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>50</span>
<span class=p>}</span>
</code></pre></div> <h3 id=configure-password-recovery><a href="https://www.youtube.com/watch?v=NKJkYz0BIlA">Configure password recovery</a><a class=headerlink href=#configure-password-recovery title="Permanent link">⚑</a></h3> <p>Recovery of password is not enabled by default, to configure it you need to create two new stages:</p> <ul> <li>An identification stage:</li> </ul> <div class=highlight><pre><span></span><code><span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_source&quot;</span><span class=w> </span><span class=nv>&quot;built_in&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>managed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;goauthentik.io/sources/inbuilt&quot;</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_identification&quot;</span><span class=w> </span><span class=nv>&quot;recovery&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;recovery-authentication-identification&quot;</span>
<span class=w>  </span><span class=na>user_fields</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;username&quot;, &quot;email&quot;</span><span class=p>]</span>
<span class=w>  </span><span class=na>sources</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=nv>data.authentik_source.built_in.uuid</span><span class=p>]</span>
<span class=w>  </span><span class=na>case_insensitive_matching</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=p>}</span>
</code></pre></div> <ul> <li>An Email recovery stage: </li> </ul> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_email&quot;</span><span class=w> </span><span class=nv>&quot;recovery&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>                     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;recovery-email&quot;</span>
<span class=w>  </span><span class=na>activate_user_on_success</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=w>  </span><span class=na>subject</span><span class=w>                  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Password Recovery&quot;</span>
<span class=w>  </span><span class=na>template</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;email/password_reset.html&quot;</span>
<span class=w>  </span><span class=na>timeout</span><span class=w>                  </span><span class=o>=</span><span class=w> </span><span class=m>10</span>
<span class=p>}</span>
</code></pre></div> <ul> <li>We will reuse two existing stages too:</li> </ul> <div class=highlight><pre><span></span><code><span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_stage&quot;</span><span class=w> </span><span class=nv>&quot;default_password_change_prompt&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;default-password-change-prompt&quot;</span>
<span class=p>}</span>

<span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_stage&quot;</span><span class=w> </span><span class=nv>&quot;default_password_change_write&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;default-password-change-write&quot;</span>
<span class=p>}</span>
</code></pre></div> <p>Then we need to create the recovery flow and bind all the stages:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow&quot;</span><span class=w> </span><span class=nv>&quot;password_recovery&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Password Recovery&quot;</span>
<span class=w>  </span><span class=na>title</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Password Recovery&quot;</span>
<span class=w>  </span><span class=na>slug</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;password-recovery&quot;</span>
<span class=w>  </span><span class=na>designation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;recovery&quot;</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;recovery_identification&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.password_recovery.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_stage_identification.recovery.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>0</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;recovery_email&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.password_recovery.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_stage_email.recovery.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>10</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;recovery_password_change&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.password_recovery.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>data.authentik_stage.default_password_change_prompt.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>20</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;recovery_password_write&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.password_recovery.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>data.authentik_stage.default_password_change_write.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>30</span>
<span class=p>}</span>
</code></pre></div> <p>Finally we need to enable it in the site's authentication flow. To be able to do change the default flow we'd need to do two manual steps, so to have all the code in terraform we will create a new tenancy for our site and a new authentication flow.</p> <p>Starting with the authentication flow we need to create the Flow, stages and stage bindings.</p> <div class=highlight><pre><span></span><code><span class=c1># -----------</span>
<span class=c1># -- Flows --</span>
<span class=c1># -----------</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow&quot;</span><span class=w> </span><span class=nv>&quot;authentication&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Welcome to Authentik!&quot;</span>
<span class=w>  </span><span class=na>title</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Welcome to Authentik!&quot;</span>
<span class=w>  </span><span class=na>slug</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;custom-authentication-flow&quot;</span>
<span class=w>  </span><span class=na>designation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;authentication&quot;</span>
<span class=w>  </span><span class=na>authentication</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;require_unauthenticated&quot;</span>
<span class=w>  </span><span class=na>compatibility_mode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
<span class=p>}</span>

<span class=c1># ------------</span>
<span class=c1># -- Stages --</span>
<span class=c1># ------------</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_stage_identification&quot;</span><span class=w> </span><span class=nv>&quot;authentication&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;custom-authentication-identification&quot;</span>
<span class=w>  </span><span class=na>user_fields</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;username&quot;, &quot;email&quot;</span><span class=p>]</span>
<span class=w>  </span><span class=na>password_stage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>data.authentik_stage.default_authentication_password.id</span>
<span class=w>  </span><span class=na>case_insensitive_matching</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
<span class=w>  </span><span class=na>recovery_flow</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.password_recovery.uuid</span>
<span class=p>}</span>

<span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_stage&quot;</span><span class=w> </span><span class=nv>&quot;default_authentication_mfa_validation&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;default-authentication-mfa-validation&quot;</span>
<span class=p>}</span>

<span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_stage&quot;</span><span class=w> </span><span class=nv>&quot;default_authentication_login&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;default-authentication-login&quot;</span>
<span class=p>}</span>

<span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_stage&quot;</span><span class=w> </span><span class=nv>&quot;default_authentication_password&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;default-authentication-password&quot;</span>
<span class=p>}</span>

<span class=c1># -------------------</span>
<span class=c1># -- Stage binding --</span>
<span class=c1># -------------------</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;login_identification&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.authentication.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_stage_identification.authentication.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>10</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;login_mfa&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.authentication.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>data.authentik_stage.default_authentication_mfa_validation.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>20</span>
<span class=p>}</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_flow_stage_binding&quot;</span><span class=w> </span><span class=nv>&quot;login_login&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.authentication.uuid</span>
<span class=w>  </span><span class=na>stage</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>data.authentik_stage.default_authentication_login.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>30</span>
<span class=p>}</span>
</code></pre></div> <p>Now we can bind it to the new tenant for our site:</p> <div class=highlight><pre><span></span><code><span class=c1># ------------</span>
<span class=c1># -- Tenant --</span>
<span class=c1># ------------</span>

<span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_tenant&quot;</span><span class=w> </span><span class=nv>&quot;default&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>domain</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;your-domain.org&quot;</span>
<span class=w>  </span><span class=na>default</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
<span class=w>  </span><span class=na>branding_title</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Authentik&quot;</span>
<span class=w>  </span><span class=na>branding_logo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/static/dist/assets/icons/icon_left_brand.svg&quot;</span>
<span class=w>  </span><span class=na>branding_favicon</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/static/dist/assets/icons/icon.png&quot;</span>
<span class=w>  </span><span class=na>flow_authentication</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.authentication.uuid</span>
<span class=c1>  # We need to define id instead of uuid until </span>
<span class=c1>  # https://github.com/goauthentik/terraform-provider-authentik/issues/305</span>
<span class=c1>  # is fixed.</span>
<span class=w>  </span><span class=na>flow_invalidation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>data.authentik_flow.default_invalidation_flow.id</span>
<span class=w>  </span><span class=na>flow_user_settings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>data.authentik_flow.default_user_settings_flow.id</span>
<span class=w>  </span><span class=na>flow_recovery</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_flow.password_recovery.uuid</span>
<span class=p>}</span>

<span class=c1># -----------</span>
<span class=c1># -- Flows --</span>
<span class=c1># -----------</span>

<span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_flow&quot;</span><span class=w> </span><span class=nv>&quot;default_invalidation_flow&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>slug</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;default-invalidation-flow&quot;</span>
<span class=p>}</span>

<span class=kr>data</span><span class=w> </span><span class=nc>&quot;authentik_flow&quot;</span><span class=w> </span><span class=nv>&quot;default_user_settings_flow&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>slug</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;default-user-settings-flow&quot;</span>
<span class=p>}</span>
</code></pre></div> <h3 id=use-blueprints><a href=https://goauthentik.io/developer-docs/blueprints/ >Use blueprints</a><a class=headerlink href=#use-blueprints title="Permanent link">⚑</a></h3> <p>WARNING: <a href=#terraform>Use the <code>terraform</code> provider instead!!!</a></p> <p>Blueprints offer a new way to template, automate and distribute authentik configuration. Blueprints can be used to automatically configure instances, manage config as code without any external tools, and to distribute application configs.</p> <p>Blueprints are yaml files, whose format is described further in <a href=https://goauthentik.io/developer-docs/blueprints/v1/structure>File structure</a> and uses <a href=https://goauthentik.io/developer-docs/blueprints/v1/tags>YAML tags</a> to configure the objects. It can be complicated when you first look at it, reading <a href=https://goauthentik.io/developer-docs/blueprints/v1/example>this example</a> may help.</p> <p>Blueprints can be applied in one of two ways:</p> <ul> <li>As a Blueprint instance, which is a YAML file mounted into the authentik (worker) container. This file is read and applied every time it changes. Multiple instances can be created for a single blueprint file, and instances can be given context key:value attributes to configure the blueprint.</li> <li>As a Flow import, which is a YAML file uploaded via the Browser/API. This file is validated and applied directly after being uploaded, but is not further monitored/applied.</li> </ul> <p>The authentik container by default looks for blueprints in <code>/blueprints</code>. Underneath this directory, there are a couple default subdirectories:</p> <ul> <li><code>/blueprints/default</code>: Default blueprints for default flows, tenants, etc</li> <li><code>/blueprints/example</code>: Example blueprints for common configurations and flows</li> <li><code>/blueprints/system</code>: System blueprints for authentik managed Property mappings, etc</li> </ul> <p>Any additional <code>.yaml</code> file in /blueprints will be discovered and automatically instantiated, depending on their labels.</p> <p>To disable existing blueprints, an empty file can be mounted over the existing blueprint.</p> <p>File-based blueprints are automatically removed once they become unavailable, however none of the objects created by those blueprints are affected by this.</p> <h4 id=export-blueprints><a href=https://goauthentik.io/developer-docs/blueprints/export>Export blueprints</a><a class=headerlink href=#export-blueprints title="Permanent link">⚑</a></h4> <p>Exports from either method will contain a (potentially) long list of objects, all with hardcoded primary keys and no ability for templating/instantiation. This is because currently, authentik does not check which primary keys are used where. It is assumed that for most exports, there'll be some manual changes done regardless, to filter out unwanted objects, adjust properties, etc. That's why it may be better to use the <a href=#flow-export>flow export</a> for the resources you've created rather than the <a href=#global-export>global export</a>.</p> <h5 id=global-export>Global export<a class=headerlink href=#global-export title="Permanent link">⚑</a></h5> <p>To migrate existing configurations to blueprints, run <code>ak export_blueprint</code> within any authentik Worker container. This will output a blueprint for most currently created objects. Some objects will not be exported as they might have dependencies on other things.</p> <p>Exported blueprints don't use any of the YAML Tags, they just contain a list of entries as they are in the database.</p> <p>Note that fields which are write-only (for example, OAuth Provider's Secret Key) will not be added to the blueprint, as the serialisation logic from the API is used for blueprints.</p> <p>Additionally, default values will be skipped and not added to the blueprint.</p> <h5 id=flow-export>Flow export<a class=headerlink href=#flow-export title="Permanent link">⚑</a></h5> <p>Instead of exporting everything from a single instance, there's also the option to export a single flow with it's attached stages, policies and other objects.</p> <p>This export can be triggered via the API or the Web UI by clicking the download button in the flow list.</p> <h3 id=hide-and-application-from-a-user><a href=https://goauthentik.io/docs/applications#authorization>Hide and application from a user</a><a class=headerlink href=#hide-and-application-from-a-user title="Permanent link">⚑</a></h3> <p>Application access can be configured using (Policy) Bindings. Click on an application in the applications list, and select the Policy / Group / User Bindings tab. There you can bind users/groups/policies to grant them access. When nothing is bound, everyone has access. You can use this to grant access to one or multiple users/groups, or dynamically give access using policies.</p> <p>With terraform you can use <code>authentik_policy_binding</code>, for example:</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;authentik_policy_binding&quot;</span><span class=w> </span><span class=nv>&quot;admin&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=na>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_application.gitea.uuid</span>
<span class=w>  </span><span class=na>group</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>authentik_group.admins.id</span>
<span class=w>  </span><span class=na>order</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=m>0</span>
<span class=p>}</span>
</code></pre></div> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">⚑</a></h2> <ul> <li><a href=https://github.com/goauthentik/authentik>Source</a></li> <li><a href=https://goauthentik.io/docs/ >Docs</a></li> <li> <p><a href=https://goauthentik.io/ >Home</a></p> </li> <li> <p><a href=https://registry.terraform.io/providers/goauthentik/authentik/latest/docs>Terraform provider docs</a></p> </li> <li><a href=https://github.com/goauthentik/terraform-provider-authentik>Terraform provider source code</a></li> </ul> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-03-23T21:49:57+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-03-23</span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../devops/prometheus/prometheus_troubleshooting/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Prometheus Troubleshooting" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Prometheus Troubleshooting </div> </div> </a> <a href=../ombi/ class="md-footer__link md-footer__link--next" aria-label="Next: Ombi" rel=next> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Ombi </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/nullniverse target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.footer", "navigation.instant", "navigation.top", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.220ee61c.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>