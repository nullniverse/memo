<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My personal digital garden"><meta name=author content=Lyz><link href=https://memo.nullniverse.xyz/velero/ rel=canonical><link href=../kubernetes_debugging/ rel=prev><link href=../devops/kubernetes/kubernetes_tools/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.1.3"><title>Velero - My Memo</title><link rel=stylesheet href=../assets/stylesheets/main.c4a75a56.min.css><link rel=stylesheet href=../assets/stylesheets/palette.a0c5b2b5.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#installation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> For updates subscribe to the <a href=https://memo.nullniverse.xyz/newsletter/0_newsletter_index/ ><strong>RSS feed</strong></a> <img src=/memo/img/orange_logo.png height=15 width=15> </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="My Memo" class="md-header__button md-logo" aria-label="My Memo" data-md-component=logo> <img src=../img/logo.bmp alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> My Memo </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Velero </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/nullniverse/memo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nullniverse/memo </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="My Memo" class="md-nav__button md-logo" aria-label="My Memo" data-md-component=logo> <img src=../img/logo.bmp alt=logo> </a> My Memo </label> <div class=md-nav__source> <a href=https://github.com/nullniverse/memo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nullniverse/memo </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../contact/ class=md-nav__link> Contact </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__link--index "> <a href=../devops/devops/ >DevOps</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> DevOps </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> Infrastructure as Code <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Infrastructure as Code </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gitea/ class=md-nav__link> Gitea </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/helm/helm/ >Helm</a> <label for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/helm/helm_installation/ class=md-nav__link> Helm Installation </a> </li> <li class=md-nav__item> <a href=../devops/helm/helm_commands/ class=md-nav__link> Helm Commands </a> </li> <li class=md-nav__item> <a href=../devops/helm/helm_secrets/ class=md-nav__link> Helm Secrets </a> </li> <li class=md-nav__item> <a href=../helm_git/ class=md-nav__link> Helm Git </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/helmfile/ class=md-nav__link> Helmfile </a> </li> <li class=md-nav__item> <a href=../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../ansible_snippets/ class=md-nav__link> Ansible Snippets </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_6> <div class="md-nav__link md-nav__link--index "> <a href=../dotfiles/ >Dotfiles</a> <label for=__nav_3_1_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_6> <span class="md-nav__icon md-icon"></span> Dotfiles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chezmoi/ class=md-nav__link> Chezmoi </a> </li> <li class=md-nav__item> <a href=../dotdrop/ class=md-nav__link> Dotdrop </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> Infrastructure Solutions <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Infrastructure Solutions </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1 checked> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubernetes/kubernetes/ >Kubernetes</a> <label for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_architecture/ class=md-nav__link> Architecture </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_2> <label class=md-nav__link for=__nav_3_2_1_2 id=__nav_3_2_1_2_label tabindex=0> Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_2> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_namespaces/ class=md-nav__link> Namespaces </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_pods/ class=md-nav__link> Pods </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_replicasets/ class=md-nav__link> ReplicaSets </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_deployments/ class=md-nav__link> Deployments </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_volumes/ class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_services/ class=md-nav__link> Services </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_labels/ class=md-nav__link> Labels </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_annotations/ class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_ingress/ class=md-nav__link> Ingress </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_operators/ class=md-nav__link> Operators </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_jobs/ class=md-nav__link> Jobs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubectl/kubectl/ >Kubectl</a> <label for=__nav_3_2_1_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_3> <span class="md-nav__icon md-icon"></span> Kubectl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubectl/kubectl_installation/ class=md-nav__link> Kubectl Installation </a> </li> <li class=md-nav__item> <a href=../devops/kubectl/kubectl_commands/ class=md-nav__link> Kubectl Commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_4> <label class=md-nav__link for=__nav_3_2_1_4 id=__nav_3_2_1_4_label tabindex=0> Additional Components <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_4> <span class="md-nav__icon md-icon"></span> Additional Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_metric_server/ class=md-nav__link> Metrics Server </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_ingress_controller/ class=md-nav__link> Ingress Controller </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_external_dns/ class=md-nav__link> External DNS </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_cluster_autoscaler/ class=md-nav__link> Cluster Autoscaler </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_dashboard/ class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_storage_driver/ class=md-nav__link> Storage Driver </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_vertical_pod_autoscaler/ class=md-nav__link> Vertical Pod Autoscaler </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_networking/ class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../kubernetes_debugging/ class=md-nav__link> Debugging </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_7 checked> <label class=md-nav__link for=__nav_3_2_1_7 id=__nav_3_2_1_7_label tabindex=0> Backups <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_7_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2_1_7> <span class="md-nav__icon md-icon"></span> Backups </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Velero <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Velero </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> <nav class=md-nav aria-label=Installation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client-instalation class=md-nav__link> Client instalation </a> </li> <li class=md-nav__item> <a href=#server-configuration class=md-nav__link> Server configuration </a> </li> <li class=md-nav__item> <a href=#monitorization class=md-nav__link> Monitorization </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#restore-backups class=md-nav__link> Restore backups </a> <nav class=md-nav aria-label="Restore backups"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overwrite-existing-resources class=md-nav__link> Overwrite existing resources </a> </li> <li class=md-nav__item> <a href=#restore-only-a-namespace class=md-nav__link> Restore only a namespace </a> </li> <li class=md-nav__item> <a href=#restore-only-a-subsection-of-the-backup class=md-nav__link> Restore only a subsection of the backup </a> </li> <li class=md-nav__item> <a href=#restore-from-a-snapshot-not-done-by-velero class=md-nav__link> Restore from a snapshot not done by velero </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#overview-of-velero class=md-nav__link> Overview of Velero </a> <nav class=md-nav aria-label="Overview of Velero"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backups class=md-nav__link> Backups </a> <nav class=md-nav aria-label=Backups> <ul class=md-nav__list> <li class=md-nav__item> <a href=#on-demand-backups class=md-nav__link> On demand backups </a> </li> <li class=md-nav__item> <a href=#scheduled-backups class=md-nav__link> Scheduled backups </a> </li> <li class=md-nav__item> <a href=#backup-workflow class=md-nav__link> Backup workflow </a> </li> <li class=md-nav__item> <a href=#set-expiration-date-of-a-backup class=md-nav__link> Set expiration date of a backup </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#restores class=md-nav__link> Restores </a> <nav class=md-nav aria-label=Restores> <ul class=md-nav__list> <li class=md-nav__item> <a href=#restore-workflow class=md-nav__link> Restore workflow </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_8> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubernetes/kubernetes_tools/ >Tools</a> <label for=__nav_3_2_1_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_8> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../krew/ class=md-nav__link> Krew </a> </li> <li class=md-nav__item> <a href=../ksniff/ class=md-nav__link> Ksniff </a> </li> <li class=md-nav__item> <a href=../mizu/ class=md-nav__link> Mizu </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/aws/aws/ >AWS</a> <label for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws_snippets/ class=md-nav__link> AWS Snippets </a> </li> <li class=md-nav__item> <a href=../aws_savings_plan/ class=md-nav__link> AWS Savings plan </a> </li> <li class=md-nav__item> <a href=../devops/aws/security_groups/ class=md-nav__link> Security groups workflow </a> </li> <li class=md-nav__item> <a href=../devops/aws/eks/ class=md-nav__link> EKS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2_5> <div class="md-nav__link md-nav__link--index "> <a href=../devops/aws/iam/iam/ >IAM</a> <label for=__nav_3_2_2_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2_5> <span class="md-nav__icon md-icon"></span> IAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/aws/iam/iam_commands/ class=md-nav__link> IAM Commands </a> </li> <li class=md-nav__item> <a href=../devops/aws/iam/iam_debug/ class=md-nav__link> IAM Debugging </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/aws/s3/ class=md-nav__link> S3 </a> </li> <li class=md-nav__item> <a href=../aws_waf/ class=md-nav__link> WAF </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/ci/ >Continuous Integration</a> <label for=__nav_3_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Continuous Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../drone/ class=md-nav__link> Drone </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_2> <label class=md-nav__link for=__nav_3_3_2 id=__nav_3_3_2_label tabindex=0> Linters <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Linters </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/alex/ class=md-nav__link> Alex </a> </li> <li class=md-nav__item> <a href=../flakeheaven/ class=md-nav__link> Flakeheaven </a> </li> <li class=md-nav__item> <a href=../devops/flake8/ class=md-nav__link> Flake8 </a> </li> <li class=md-nav__item> <a href=../devops/markdownlint/ class=md-nav__link> Markdownlint </a> </li> <li class=md-nav__item> <a href=../devops/proselint/ class=md-nav__link> Proselint </a> </li> <li class=md-nav__item> <a href=../devops/yamllint/ class=md-nav__link> Yamllint </a> </li> <li class=md-nav__item> <a href=../devops/write_good/ class=md-nav__link> Write Good </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_3> <label class=md-nav__link for=__nav_3_3_3 id=__nav_3_3_3_label tabindex=0> Formatters/Fixers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_3> <span class="md-nav__icon md-icon"></span> Formatters/Fixers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/black/ class=md-nav__link> Black </a> </li> <li class=md-nav__item> <a href=../yamlfix/ class=md-nav__link> Yamlfix </a> </li> <li class=md-nav__item> <a href=../pyment/ class=md-nav__link> Pyment </a> </li> <li class=md-nav__item> <a href=../mdformat/ class=md-nav__link> mdformat </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_4> <label class=md-nav__link for=__nav_3_3_4 id=__nav_3_3_4_label tabindex=0> Type Checkers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_4> <span class="md-nav__icon md-icon"></span> Type Checkers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/mypy/ class=md-nav__link> Mypy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_5> <label class=md-nav__link for=__nav_3_3_5 id=__nav_3_3_5_label tabindex=0> Security Checkers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_5> <span class="md-nav__icon md-icon"></span> Security Checkers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/safety/ class=md-nav__link> Safety </a> </li> <li class=md-nav__item> <a href=../devops/bandit/ class=md-nav__link> Bandit </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_6> <label class=md-nav__link for=__nav_3_3_6 id=__nav_3_3_6_label tabindex=0> Dependency managers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_6> <span class="md-nav__icon md-icon"></span> Dependency managers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/pip_tools/ class=md-nav__link> Pip-tools </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> Automating Processes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Automating Processes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../linux/cookiecutter/ class=md-nav__link> cookiecutter </a> </li> <li class=md-nav__item> <a href=../linux/cruft/ class=md-nav__link> cruft </a> </li> <li class=md-nav__item> <a href=../renovate/ class=md-nav__link> renovate </a> </li> <li class=md-nav__item> <a href=../letsencrypt/ class=md-nav__link> letsencrypt </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <div class="md-nav__link md-nav__link--index "> <a href=../storage/ >Storage</a> <label for=__nav_3_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_1> <div class="md-nav__link md-nav__link--index "> <a href=../linux/zfs/ >OpenZFS</a> <label for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> OpenZFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../zfs_storage_planning/ class=md-nav__link> OpenZFS storage planning </a> </li> <li class=md-nav__item> <a href=../sanoid/ class=md-nav__link> Sanoid </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../monitoring_comparison/ class=md-nav__link> Monitoring Comparison </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/prometheus/prometheus/ >Prometheus</a> <label for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> Prometheus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_architecture/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_operator/ class=md-nav__link> Prometheus Operator </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_installation/ class=md-nav__link> Prometheus Install </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/alertmanager/ class=md-nav__link> AlertManager </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/blackbox_exporter/ class=md-nav__link> Blackbox Exporter </a> </li> <li class=md-nav__item> <a href=../elasticsearch_exporter/ class=md-nav__link> Elasticsearch Exporter </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/node_exporter/ class=md-nav__link> Node Exporter </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/instance_sizing_analysis/ class=md-nav__link> Instance sizing analysis </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_troubleshooting/ class=md-nav__link> Prometheus Troubleshooting </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> Authentication <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Authentication </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../authentik/ class=md-nav__link> Authentik </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex=0> Self-hosted services <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Self-hosted services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ombi/ class=md-nav__link> Ombi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <div class="md-nav__link md-nav__link--index "> <a href=../devops/api_management/ >API Management</a> <label for=__nav_3_9> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> API Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kong/kong/ class=md-nav__link> Kong </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../newsletter/0_newsletter_index/ class=md-nav__link> Newsletters </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> <nav class=md-nav aria-label=Installation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client-instalation class=md-nav__link> Client instalation </a> </li> <li class=md-nav__item> <a href=#server-configuration class=md-nav__link> Server configuration </a> </li> <li class=md-nav__item> <a href=#monitorization class=md-nav__link> Monitorization </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#restore-backups class=md-nav__link> Restore backups </a> <nav class=md-nav aria-label="Restore backups"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overwrite-existing-resources class=md-nav__link> Overwrite existing resources </a> </li> <li class=md-nav__item> <a href=#restore-only-a-namespace class=md-nav__link> Restore only a namespace </a> </li> <li class=md-nav__item> <a href=#restore-only-a-subsection-of-the-backup class=md-nav__link> Restore only a subsection of the backup </a> </li> <li class=md-nav__item> <a href=#restore-from-a-snapshot-not-done-by-velero class=md-nav__link> Restore from a snapshot not done by velero </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#overview-of-velero class=md-nav__link> Overview of Velero </a> <nav class=md-nav aria-label="Overview of Velero"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backups class=md-nav__link> Backups </a> <nav class=md-nav aria-label=Backups> <ul class=md-nav__list> <li class=md-nav__item> <a href=#on-demand-backups class=md-nav__link> On demand backups </a> </li> <li class=md-nav__item> <a href=#scheduled-backups class=md-nav__link> Scheduled backups </a> </li> <li class=md-nav__item> <a href=#backup-workflow class=md-nav__link> Backup workflow </a> </li> <li class=md-nav__item> <a href=#set-expiration-date-of-a-backup class=md-nav__link> Set expiration date of a backup </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#restores class=md-nav__link> Restores </a> <nav class=md-nav aria-label=Restores> <ul class=md-nav__list> <li class=md-nav__item> <a href=#restore-workflow class=md-nav__link> Restore workflow </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Velero</h1> <p><a href=https://velero.io/ >Velero</a> is an open source tool to safely backup and restore, perform disaster recovery, and migrate Kubernetes cluster resources and persistent volumes.</p> <h2 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">⚑</a></h2> <h3 id=client-instalation>Client instalation<a class=headerlink href=#client-instalation title="Permanent link">⚑</a></h3> <p>You interact with <code>velero</code> through a client command line.</p> <ul> <li>Download the <a href=https://github.com/vmware-tanzu/velero/releases/latest>latest release’s tarball</a> for your client platform.</li> <li>Extract the tarball:</li> </ul> <p><div class=highlight><pre><span></span><code>tar<span class=w> </span>-xvf<span class=w> </span>&lt;RELEASE-TARBALL-NAME&gt;.tar.gz
</code></pre></div> * Move the extracted velero binary to somewhere in your <code>$PATH</code>.</p> <h3 id=server-configuration>Server configuration<a class=headerlink href=#server-configuration title="Permanent link">⚑</a></h3> <p>Instead of configuring the server through the <code>velero</code> command line it's better to use the <a href=https://github.com/vmware-tanzu/helm-charts/tree/main/charts/velero>vmware-tanzu/velero</a> chart.</p> <p>To configure backup policy use the <code>extraObjects</code> chart field. For example to backup everything with the next policy do:</p> <ul> <li>Hourly backups for a day.</li> <li>Daily backups for a month.</li> <li>Montly backups for a year.</li> <li>Yearly backups forever.</li> </ul> <div class=highlight><pre><span></span><code><span class=nt>extraObjects</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Schedule</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-1h</span>
<span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>      </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s>&#39;@every</span><span class=nv> </span><span class=s>1h&#39;</span>
<span class=w>      </span><span class=nt>template</span><span class=p>:</span>
<span class=w>        </span><span class=nt>csiSnapshotTimeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0s</span>
<span class=w>        </span><span class=nt>hooks</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>includedNamespaces</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;*&#39;</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>ttl</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">25h0m0s</span>
<span class=w>      </span><span class=nt>useOwnerReferencesInBackup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Schedule</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-1d</span>
<span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>      </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s>&#39;@every</span><span class=nv> </span><span class=s>24h&#39;</span>
<span class=w>      </span><span class=nt>template</span><span class=p>:</span>
<span class=w>        </span><span class=nt>csiSnapshotTimeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0s</span>
<span class=w>        </span><span class=nt>hooks</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>includedNamespaces</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;*&#39;</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>ttl</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">730h0m0s</span>
<span class=w>      </span><span class=nt>useOwnerReferencesInBackup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Schedule</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-1m</span>
<span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>      </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s>&#39;@every</span><span class=nv> </span><span class=s>730h&#39;</span>
<span class=w>      </span><span class=nt>template</span><span class=p>:</span>
<span class=w>        </span><span class=nt>csiSnapshotTimeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0s</span>
<span class=w>        </span><span class=nt>hooks</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>includedNamespaces</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;*&#39;</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>ttl</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8760h0m0s</span>
<span class=w>      </span><span class=nt>useOwnerReferencesInBackup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Schedule</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-1y</span>
<span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>      </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s>&#39;@every</span><span class=nv> </span><span class=s>8760h&#39;</span>
<span class=w>      </span><span class=nt>template</span><span class=p>:</span>
<span class=w>        </span><span class=nt>csiSnapshotTimeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0s</span>
<span class=w>        </span><span class=nt>hooks</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>includedNamespaces</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;*&#39;</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>ttl</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0s</span>
<span class=w>      </span><span class=nt>useOwnerReferencesInBackup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
</code></pre></div> <h3 id=monitorization>Monitorization<a class=headerlink href=#monitorization title="Permanent link">⚑</a></h3> <p>Assuming you're using <a href=../devops/prometheus/prometheus/ >prometheus</a> you can add the next prometheus rules in the chart:</p> <div class=highlight><pre><span></span><code><span class=c1># -------------------------------------------------------------</span>
<span class=c1># --   Monitor the failures when doing backups or restores   --</span>
<span class=c1># -------------------------------------------------------------</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroBackupPartialFailures</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Velero backup {{ $labels.schedule }} has {{ $value | humanizePercentage }} partialy failed backups.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">increase(velero_backup_partial_failure_total{schedule!=&quot;&quot;}[1h]) &gt; 0</span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroBackupFailures</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Velero backup {{ $labels.schedule }} has {{ $value | humanizePercentage }} failed backups.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">increase(velero_backup_failure_total{schedule!=&quot;&quot;}[1h]) &gt; 0</span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroBackupSnapshotFailures</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Velero backup {{ $labels.schedule }} has {{ $value | humanizePercentage }} failed snapshot backups.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">increase(velero_volume_snapshot_failure_total{schedule!=&quot;&quot;}[1h]) &gt; 0</span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroRestorePartialFailures</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Velero restore {{ $labels.schedule }} has {{ $value | humanizePercentage }} partialy failed restores.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">increase(velero_restore_partial_failure_total{schedule!=&quot;&quot;}[1h]) &gt; 0</span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroRestoreFailures</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Velero restore {{ $labels.schedule }} has {{ $value | humanizePercentage }} failed restores.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">increase(velero_restore_failure_total{schedule!=&quot;&quot;}[1h]) &gt; 0</span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>

<span class=c1># ------------------------------------------------</span>
<span class=c1># --   Monitor the backup rate of each policy   --</span>
<span class=c1># ------------------------------------------------</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroHourlyBackupFailure</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">There are no new hourly velero backups in the last hour.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">time() - velero_backup_last_successful_timestamp{schedule=&quot;backup-1h&quot;} &gt; 3600</span><span class=w> </span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroDailyBackupFailure</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">There are no new daily velero backups in the last day.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">time() - velero_backup_last_successful_timestamp{schedule=&quot;backup-1d&quot;} &gt; 3600 * 24</span><span class=w> </span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroMonthlyBackupFailure</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">There are no new montly velero backups in the last month.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">time() - velero_backup_last_successful_timestamp{schedule=&quot;backup-1m&quot;} &gt; 3600 * 24 * 30</span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroYearlyBackupFailure</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">There are no new yearly velero backups in the last year.</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">time() - velero_backup_last_successful_timestamp{schedule=&quot;backup-1y&quot;} &gt; 3600 * 24 * 365</span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>

<span class=c1># -------------------------------------</span>
<span class=c1># --   Monitor the backup cleaning   --</span>
<span class=c1># -------------------------------------</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VeleroBackupCleaningFailure</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">There are more backups than the expected, deletion policy may not be working well.</span>
<span class=w>    </span><span class=c1># Desired backups:</span>
<span class=w>    </span><span class=c1># - 25 hourlys</span>
<span class=w>    </span><span class=c1># - 31 dailys</span>
<span class=w>    </span><span class=c1># - 12 monthlys</span>
<span class=w>    </span><span class=c1># - 10 yearlys</span>
<span class=w>  </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero_backup_total &gt; (25 + 31 + 12 + 10)</span>
<span class=w>  </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
</code></pre></div> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">⚑</a></h2> <h3 id=restore-backups>Restore backups<a class=headerlink href=#restore-backups title="Permanent link">⚑</a></h3> <p>To get the available backups you can use:</p> <div class=highlight><pre><span></span><code>velero<span class=w> </span>get<span class=w> </span>backups
</code></pre></div> <p>Imagine we want to restore the backup <code>backup-1h-20230109125511</code>.</p> <p>We first need to update your backup storage location to read-only mode. This prevents backup objects from being created or deleted in the backup storage location during the restore process.</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>patch<span class=w> </span>backupstoragelocation<span class=w> </span>default<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--namespace<span class=w> </span>velero<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--type<span class=w> </span>merge<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--patch<span class=w> </span><span class=s1>&#39;{&quot;spec&quot;:{&quot;accessMode&quot;:&quot;ReadOnly&quot;}}&#39;</span>
</code></pre></div> <p>Where <code>default</code> is the only backup storage location I have, check what's the name of your's by running <code>kubectl get backupstoragelocation -n velero</code>.</p> <p>You'd now run the <code>velero restore create</code> commands (we'll see more examples in next sections). For example:</p> <ul> <li>Create a restore with a default name <code>backup-1-&lt;timestamp&gt;</code> from backup <code>backup-1</code>.</li> </ul> <div class=highlight><pre><span></span><code>velero<span class=w> </span>restore<span class=w> </span>create<span class=w> </span>--from-backup<span class=w> </span>backup-1
</code></pre></div> <ul> <li>Create a restore with name <code>restore-1</code> from a backup called <code>backup-1</code> .</li> </ul> <div class=highlight><pre><span></span><code>velero<span class=w> </span>restore<span class=w> </span>create<span class=w> </span>restore-1<span class=w> </span>--from-backup<span class=w> </span>backup-1
</code></pre></div> <ul> <li>Create a restore from the latest successful backup triggered by schedule <code>schedule-1</code>.</li> </ul> <div class=highlight><pre><span></span><code>velero<span class=w> </span>restore<span class=w> </span>create<span class=w> </span>--from-schedule<span class=w> </span>schedule-1
</code></pre></div> <p>When you run the command they'll will show you how to monitor the evolution of the restore with commands similar to:</p> <div class=highlight><pre><span></span><code>velero<span class=w> </span>restore<span class=w> </span>describe<span class=w> </span>backup-1h-20230109125511-20230110145314
velero<span class=w> </span>restore<span class=w> </span>logs<span class=w> </span>backup-1h-20230109125511-20230110145314
</code></pre></div> <p>Once they're done, remember to reset the ReadWrite permissions on the backup location.</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>patch<span class=w> </span>backupstoragelocation<span class=w> </span>default<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--namespace<span class=w> </span>velero<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--type<span class=w> </span>merge<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--patch<span class=w> </span><span class=s1>&#39;{&quot;spec&quot;:{&quot;accessMode&quot;:&quot;ReadWrite&quot;}}&#39;</span>
</code></pre></div> <h4 id=overwrite-existing-resources><a href=https://velero.io/docs/main/restore-reference/#restore-existing-resource-policy>Overwrite existing resources</a><a class=headerlink href=#overwrite-existing-resources title="Permanent link">⚑</a></h4> <p>The only way I've found to do this is by removing the namespace and then restore it with <code>velero</code>. If you want to try to do it in a cleaner way keep on reading (although for me it didn't work!).</p> <p>By default, Velero is configured to be non-destructive during a restore. This means that it will never overwrite data that already exists in your cluster. When Velero attempts to create a resource during a restore, the resource being restored is compared to the existing resources on the target cluster by the Kubernetes API Server. If the resource already exists in the target cluster, Velero skips restoring the current resource and moves onto the next resource to restore, without making any changes to the target cluster.</p> <p>You can change this policy for a restore by using the <code>--existing-resource-policy</code> restore flag. The available options are <code>none</code> (default) and <code>update</code>. If you choose to update existing resources during a restore (<code>--existing-resource-policy=update</code>), Velero will attempt to update an existing resource to match the resource being restored:</p> <ul> <li> <p>If the existing resource in the target cluster is the same as the resource Velero is attempting to restore, Velero will add a <code>velero.io/backup-name</code> label with the backup name and a <code>velero.io/restore-name</code> label with the restore name to the existing resource. If patching the labels fails, Velero adds a restore error and continues restoring the next resource.</p> </li> <li> <p>If the existing resource in the target cluster is different from the backup, Velero will first try to patch the existing resource to match the backup resource. If the patch is successful, Velero will add a <code>velero.io/backup-name</code> label with the backup name and a <code>velero.io/restore-name</code> label with the restore name to the existing resource. If the patch fails, Velero adds a restore warning and tries to add the <code>velero.io/backup-name</code> and <code>velero.io/restore-name</code> labels on the resource. If the labels patch also fails, then Velero logs a restore error and continues restoring the next resource.</p> </li> </ul> <p>Even with these flags the restore of PersistentVolumeClaim doesn't work.</p> <h4 id=restore-only-a-namespace>Restore only a namespace<a class=headerlink href=#restore-only-a-namespace title="Permanent link">⚑</a></h4> <div class=highlight><pre><span></span><code>velero<span class=w> </span>restore<span class=w> </span>create<span class=w> </span>--include-namespaces<span class=w> </span>monitoring
</code></pre></div> <h4 id=restore-only-a-subsection-of-the-backup>Restore only a subsection of the backup<a class=headerlink href=#restore-only-a-subsection-of-the-backup title="Permanent link">⚑</a></h4> <p>You can list the backed up resources with:</p> <div class=highlight><pre><span></span><code>velero<span class=w> </span>describe<span class=w> </span>backups<span class=w> </span>backup-1h-20230109125511
</code></pre></div> <p>Then you can create a restore for only <code>persistentvolumeclaims</code> and <code>persistentvolumes</code> within a backup.</p> <div class=highlight><pre><span></span><code>velero<span class=w> </span>restore<span class=w> </span>create<span class=w> </span>--from-backup<span class=w> </span>backup-2<span class=w> </span>--include-resources<span class=w> </span>persistentvolumeclaims,persistentvolumes
</code></pre></div> <h4 id=restore-from-a-snapshot-not-done-by-velero>Restore from a snapshot not done by velero<a class=headerlink href=#restore-from-a-snapshot-not-done-by-velero title="Permanent link">⚑</a></h4> <p>If you want to use an EBS snapshot that is not managed by <code>velero</code> you need to:</p> <ul> <li>Locate a <code>velero</code> backup which has done a backup of the resources you want to restore. Imagine it's <code>backup-1</code>. </li> <li>Go to the <code>backup-1</code> directory in the S3 bucket where velero stores the data.</li> <li>Download and decompress the <code>backup-1-volumesnapshots.json.gz</code> file.</li> <li>Edit the result <code>json</code> and restore the <code>snap-.*</code> strings of the <code>pvc</code> that you want to restore for the ones that are not managed by velero.</li> <li>Compress the file and upload it to the S3 bucket.</li> <li>Restore the backup</li> </ul> <p>Keep in mind that if you are trying to restore a backup created by an EBS lifecycle hook you'll receive an error when restoring because these snapshots have a tag that starts with <code>aws:</code> which is reserved for AWS only. The solution is to copy the snapshot into a new one, assign a tag, for example <code>Name</code>, and use that snapshot instead. If you don't define any tag you'll get another error :/.</p> <h2 id=overview-of-velero><a href=https://velero.io/docs/main/how-velero-works/ >Overview of Velero</a><a class=headerlink href=#overview-of-velero title="Permanent link">⚑</a></h2> <p>Each Velero operation – on-demand backup, scheduled backup, restore – is a custom resource, defined with a Kubernetes Custom Resource Definition (CRD) and stored in etcd. Velero also includes controllers that process the custom resources to perform backups, restores, and all related operations.</p> <p>You can back up or restore all objects in your cluster, or you can filter objects by type, namespace, and/or label.</p> <h3 id=backups>Backups<a class=headerlink href=#backups title="Permanent link">⚑</a></h3> <h4 id=on-demand-backups><a href=https://velero.io/docs/main/how-velero-works/#on-demand-backups>On demand backups</a><a class=headerlink href=#on-demand-backups title="Permanent link">⚑</a></h4> <p>The backup operation:</p> <ul> <li>Uploads a tarball of copied Kubernetes objects into cloud object storage.</li> <li>Calls the cloud provider API to make disk snapshots of persistent volumes, if specified.</li> </ul> <p>You can optionally specify backup hooks to be executed during the backup. For example, you might need to tell a database to flush its in-memory buffers to disk before taking a snapshot. </p> <p>Note that cluster backups are not strictly atomic. If Kubernetes objects are being created or edited at the time of backup, they might not be included in the backup. The odds of capturing inconsistent information are low, but it is possible.</p> <h4 id=scheduled-backups><a href=https://velero.io/docs/main/how-velero-works/#scheduled-backups>Scheduled backups</a><a class=headerlink href=#scheduled-backups title="Permanent link">⚑</a></h4> <p>The schedule operation allows you to back up your data at recurring intervals. You can create a scheduled backup at any time, and the first backup is then performed at the schedule’s specified interval. These intervals are specified by a Cron expression.</p> <p>Velero saves backups created from a schedule with the name <code>&lt;SCHEDULE NAME&gt;-&lt;TIMESTAMP&gt;</code>, where <code>&lt;TIMESTAMP&gt;</code> is formatted as <code>YYYYMMDDhhmmss</code>.</p> <h4 id=backup-workflow><a href=https://velero.io/docs/main/how-velero-works/#backup-workflow>Backup workflow</a><a class=headerlink href=#backup-workflow title="Permanent link">⚑</a></h4> <p>When you run <code>velero backup create test-backup</code>:</p> <ul> <li>The Velero client makes a call to the Kubernetes API server to create a <code>Backup</code> object.</li> <li>The <code>BackupController</code> notices the new <code>Backup</code> object and performs validation.</li> <li>The <code>BackupController</code> begins the backup process. It collects the data to back up by querying the API server for resources.</li> <li>The <code>BackupController</code> makes a call to the object storage service – for example, AWS S3 – to upload the backup file.</li> </ul> <h4 id=set-expiration-date-of-a-backup><a href=https://velero.io/docs/main/how-velero-works/#set-a-backup-to-expire>Set expiration date of a backup</a><a class=headerlink href=#set-expiration-date-of-a-backup title="Permanent link">⚑</a></h4> <p>When you create a backup, you can specify a TTL (time to live) by adding the flag <code>--ttl &lt;DURATION&gt;</code>. If Velero sees that an existing backup resource is expired, it removes:</p> <ul> <li>The backup resource</li> <li>The backup file from cloud object storage</li> <li>All <code>PersistentVolume</code> snapshots</li> <li>All associated Restores</li> </ul> <p>The TTL flag allows the user to specify the backup retention period with the value specified in hours, minutes and seconds in the form <code>--ttl 24h0m0s</code>. If not specified, a default TTL value of 30 days will be applied.</p> <p>If backup fails to delete, a label <code>velero.io/gc-failure=&lt;Reason&gt;</code> will be added to the backup custom resource.</p> <p>You can use this label to filter and select backups that failed to delete.</p> <h3 id=restores><a href=https://velero.io/docs/main/how-velero-works/#restores>Restores</a><a class=headerlink href=#restores title="Permanent link">⚑</a></h3> <p>The restore operation allows you to restore all of the objects and persistent volumes from a previously created backup. You can also restore only a filtered subset of objects and persistent volumes. </p> <p>By default, backup storage locations are created in read-write mode. However, during a restore, you can configure a backup storage location to be in read-only mode, which disables backup creation and deletion for the storage location. This is useful to ensure that no backups are inadvertently created or deleted during a restore scenario.</p> <p>A restored object includes a label with key velero.io/restore-name and value <restore name>.</p> <p>You can optionally specify restore hooks to be executed during a restore or after resources are restored. For example, you might need to perform a custom database restore operation before the database application containers start.</p> <h4 id=restore-workflow>Restore workflow<a class=headerlink href=#restore-workflow title="Permanent link">⚑</a></h4> <p>When you run <code>velero restore create</code>:</p> <ul> <li>The Velero client makes a call to the Kubernetes API server to create a <code>Restore</code> object.</li> <li>The <code>RestoreController</code> notices the new <code>Restore</code> object and performs validation.</li> <li>The <code>RestoreController</code> fetches the backup information from the object storage service. It then runs some preprocessing on the backed up resources to make sure the resources will work on the new cluster. For example, using the backed-up API versions to verify that the restore resource will work on the target cluster.</li> <li>The <code>RestoreController</code> starts the restore process, restoring each eligible resource one at a time.</li> </ul> <p>By default, Velero performs a non-destructive restore, meaning that it won’t delete any data on the target cluster. If a resource in the backup already exists in the target cluster, Velero will skip that resource. You can configure Velero to use an update policy instead using the <code>--existing-resource-policy</code> restore flag. When this flag is set to update, Velero will attempt to update an existing resource in the target cluster to match the resource from the backup.</p> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">⚑</a></h2> <ul> <li><a href=https://velero.io/docs/main/ >Docs</a></li> <li><a href=https://github.com/vmware-tanzu/velero>Source</a></li> <li><a href=https://velero.io/ >Home</a></li> </ul> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-03-23T21:49:57+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-03-23</span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../kubernetes_debugging/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Debugging" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Debugging </div> </div> </a> <a href=../devops/kubernetes/kubernetes_tools/ class="md-footer__link md-footer__link--next" aria-label="Next: Tools" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Tools </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/nullniverse target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://nullniverse.github.io/memo/newsletter/0_newsletter_index target=_blank rel=noopener title=nullniverse.github.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64zm0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0zm32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.footer", "navigation.instant", "navigation.top", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.efa0ade1.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>