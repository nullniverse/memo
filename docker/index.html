<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My personal digital garden"><meta name=author content=Lyz><link href=https://memo.nullniverse.xyz/docker/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-9.1.21"><title>Docker - My Memo</title><link rel=stylesheet href=../assets/stylesheets/main.eebd395e.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ecc896b0.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#how-to-keep-containers-updated class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> You can find my posts on my <a href=https://blog.nullniverse.xyz/ ><strong>Blog</strong></a> <img src=img/blog_icon.png height=15 width=15> </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="My Memo" class="md-header__button md-logo" aria-label="My Memo" data-md-component=logo> <img src=../img/favicon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> My Memo </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Docker </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/nullniverse/memo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nullniverse/memo </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="My Memo" class="md-nav__button md-logo" aria-label="My Memo" data-md-component=logo> <img src=../img/favicon.png alt=logo> </a> My Memo </label> <div class=md-nav__source> <a href=https://github.com/nullniverse/memo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> nullniverse/memo </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../contact/ class=md-nav__link> Contact </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/devops/ >DevOps</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> DevOps </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> Infrastructure as Code <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Infrastructure as Code </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gitea/ class=md-nav__link> Gitea </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/helm/helm/ >Helm</a> <label for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> Helm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/helm/helm_installation/ class=md-nav__link> Helm Installation </a> </li> <li class=md-nav__item> <a href=../devops/helm/helm_commands/ class=md-nav__link> Helm Commands </a> </li> <li class=md-nav__item> <a href=../devops/helm/helm_secrets/ class=md-nav__link> Helm Secrets </a> </li> <li class=md-nav__item> <a href=../helm_git/ class=md-nav__link> Helm Git </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/helmfile/ class=md-nav__link> Helmfile </a> </li> <li class=md-nav__item> <a href=../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../ansible_snippets/ class=md-nav__link> Ansible Snippets </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_6> <div class="md-nav__link md-nav__link--index "> <a href=../dotfiles/ >Dotfiles</a> <label for=__nav_3_1_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1_6> <span class="md-nav__icon md-icon"></span> Dotfiles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../chezmoi/ class=md-nav__link> Chezmoi </a> </li> <li class=md-nav__item> <a href=../dotdrop/ class=md-nav__link> Dotdrop </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> Infrastructure Solutions <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Infrastructure Solutions </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubernetes/kubernetes/ >Kubernetes</a> <label for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_architecture/ class=md-nav__link> Architecture </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_2> <label class=md-nav__link for=__nav_3_2_1_2 id=__nav_3_2_1_2_label tabindex=0> Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_2> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_namespaces/ class=md-nav__link> Namespaces </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_pods/ class=md-nav__link> Pods </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_replicasets/ class=md-nav__link> ReplicaSets </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_deployments/ class=md-nav__link> Deployments </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_hpa/ class=md-nav__link> Horizontal Pod Autoscaling </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_volumes/ class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_services/ class=md-nav__link> Services </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_labels/ class=md-nav__link> Labels </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_annotations/ class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_ingress/ class=md-nav__link> Ingress </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_operators/ class=md-nav__link> Operators </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_jobs/ class=md-nav__link> Jobs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubectl/kubectl/ >Kubectl</a> <label for=__nav_3_2_1_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_3> <span class="md-nav__icon md-icon"></span> Kubectl </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubectl/kubectl_installation/ class=md-nav__link> Kubectl Installation </a> </li> <li class=md-nav__item> <a href=../devops/kubectl/kubectl_commands/ class=md-nav__link> Kubectl Commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_4> <label class=md-nav__link for=__nav_3_2_1_4 id=__nav_3_2_1_4_label tabindex=0> Additional Components <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_4> <span class="md-nav__icon md-icon"></span> Additional Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_metric_server/ class=md-nav__link> Metrics Server </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_ingress_controller/ class=md-nav__link> Ingress Controller </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_external_dns/ class=md-nav__link> External DNS </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_cluster_autoscaler/ class=md-nav__link> Cluster Autoscaler </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_dashboard/ class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_storage_driver/ class=md-nav__link> Storage Driver </a> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_vertical_pod_autoscaler/ class=md-nav__link> Vertical Pod Autoscaler </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/kubernetes/kubernetes_networking/ class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../kubernetes_debugging/ class=md-nav__link> Debugging </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_7> <label class=md-nav__link for=__nav_3_2_1_7 id=__nav_3_2_1_7_label tabindex=0> Backups <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_7> <span class="md-nav__icon md-icon"></span> Backups </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../velero/ class=md-nav__link> Velero </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1_8> <div class="md-nav__link md-nav__link--index "> <a href=../devops/kubernetes/kubernetes_tools/ >Tools</a> <label for=__nav_3_2_1_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_1_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1_8> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../krew/ class=md-nav__link> Krew </a> </li> <li class=md-nav__item> <a href=../ksniff/ class=md-nav__link> Ksniff </a> </li> <li class=md-nav__item> <a href=../mizu/ class=md-nav__link> Mizu </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/aws/aws/ >AWS</a> <label for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aws_snippets/ class=md-nav__link> AWS Snippets </a> </li> <li class=md-nav__item> <a href=../aws_savings_plan/ class=md-nav__link> AWS Savings plan </a> </li> <li class=md-nav__item> <a href=../devops/aws/security_groups/ class=md-nav__link> Security groups workflow </a> </li> <li class=md-nav__item> <a href=../devops/aws/eks/ class=md-nav__link> EKS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2_5> <div class="md-nav__link md-nav__link--index "> <a href=../devops/aws/iam/iam/ >IAM</a> <label for=__nav_3_2_2_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2_5> <span class="md-nav__icon md-icon"></span> IAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/aws/iam/iam_commands/ class=md-nav__link> IAM Commands </a> </li> <li class=md-nav__item> <a href=../devops/aws/iam/iam_debug/ class=md-nav__link> IAM Debugging </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../devops/aws/s3/ class=md-nav__link> S3 </a> </li> <li class=md-nav__item> <a href=../aws_waf/ class=md-nav__link> WAF </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <div class="md-nav__link md-nav__link--index "> <a href=../devops/ci/ >Continuous Integration</a> <label for=__nav_3_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Continuous Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../drone/ class=md-nav__link> Drone </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_2> <label class=md-nav__link for=__nav_3_3_2 id=__nav_3_3_2_label tabindex=0> Linters <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Linters </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/alex/ class=md-nav__link> Alex </a> </li> <li class=md-nav__item> <a href=../flakeheaven/ class=md-nav__link> Flakeheaven </a> </li> <li class=md-nav__item> <a href=../devops/flake8/ class=md-nav__link> Flake8 </a> </li> <li class=md-nav__item> <a href=../devops/markdownlint/ class=md-nav__link> Markdownlint </a> </li> <li class=md-nav__item> <a href=../devops/proselint/ class=md-nav__link> Proselint </a> </li> <li class=md-nav__item> <a href=../devops/yamllint/ class=md-nav__link> Yamllint </a> </li> <li class=md-nav__item> <a href=../devops/write_good/ class=md-nav__link> Write Good </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_3> <label class=md-nav__link for=__nav_3_3_3 id=__nav_3_3_3_label tabindex=0> Formatters/Fixers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_3> <span class="md-nav__icon md-icon"></span> Formatters/Fixers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/black/ class=md-nav__link> Black </a> </li> <li class=md-nav__item> <a href=../yamlfix/ class=md-nav__link> Yamlfix </a> </li> <li class=md-nav__item> <a href=../pyment/ class=md-nav__link> Pyment </a> </li> <li class=md-nav__item> <a href=../mdformat/ class=md-nav__link> mdformat </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_4> <label class=md-nav__link for=__nav_3_3_4 id=__nav_3_3_4_label tabindex=0> Type Checkers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_4> <span class="md-nav__icon md-icon"></span> Type Checkers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/mypy/ class=md-nav__link> Mypy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_5> <label class=md-nav__link for=__nav_3_3_5 id=__nav_3_3_5_label tabindex=0> Security Checkers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_5> <span class="md-nav__icon md-icon"></span> Security Checkers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/safety/ class=md-nav__link> Safety </a> </li> <li class=md-nav__item> <a href=../devops/bandit/ class=md-nav__link> Bandit </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_6> <label class=md-nav__link for=__nav_3_3_6 id=__nav_3_3_6_label tabindex=0> Dependency managers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_6> <span class="md-nav__icon md-icon"></span> Dependency managers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/pip_tools/ class=md-nav__link> Pip-tools </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> Automating Processes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Automating Processes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../linux/cookiecutter/ class=md-nav__link> cookiecutter </a> </li> <li class=md-nav__item> <a href=../linux/cruft/ class=md-nav__link> cruft </a> </li> <li class=md-nav__item> <a href=../renovate/ class=md-nav__link> renovate </a> </li> <li class=md-nav__item> <a href=../letsencrypt/ class=md-nav__link> letsencrypt </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <div class="md-nav__link md-nav__link--index "> <a href=../storage/ >Storage</a> <label for=__nav_3_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_1> <div class="md-nav__link md-nav__link--index "> <a href=../linux/zfs/ >OpenZFS</a> <label for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> OpenZFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../zfs_storage_planning/ class=md-nav__link> OpenZFS storage planning </a> </li> <li class=md-nav__item> <a href=../sanoid/ class=md-nav__link> Sanoid </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../monitoring_comparison/ class=md-nav__link> Monitoring Comparison </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_2> <div class="md-nav__link md-nav__link--index "> <a href=../devops/prometheus/prometheus/ >Prometheus</a> <label for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> Prometheus </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_architecture/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_operator/ class=md-nav__link> Prometheus Operator </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_installation/ class=md-nav__link> Prometheus Install </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/alertmanager/ class=md-nav__link> AlertManager </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/blackbox_exporter/ class=md-nav__link> Blackbox Exporter </a> </li> <li class=md-nav__item> <a href=../elasticsearch_exporter/ class=md-nav__link> Elasticsearch Exporter </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/node_exporter/ class=md-nav__link> Node Exporter </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/instance_sizing_analysis/ class=md-nav__link> Instance sizing analysis </a> </li> <li class=md-nav__item> <a href=../devops/prometheus/prometheus_troubleshooting/ class=md-nav__link> Prometheus Troubleshooting </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex=0> Authentication <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Authentication </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../authentik/ class=md-nav__link> Authentik </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex=0> Self-hosted services <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Self-hosted services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ombi/ class=md-nav__link> Ombi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <div class="md-nav__link md-nav__link--index "> <a href=../devops/api_management/ >API Management</a> <label for=__nav_3_9> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> API Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devops/kong/kong/ class=md-nav__link> Kong </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <div class="md-nav__link md-nav__link--index "> <a href=../language/language/ >Languages</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Languages </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../language/chinese/chinese/ class=md-nav__link> Chinese </a> </li> <li class=md-nav__item> <a href=../language/russian/russian/ class=md-nav__link> Russian </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#how-to-keep-containers-updated class=md-nav__link> How to keep containers updated </a> <nav class=md-nav aria-label="How to keep containers updated"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#with-renovate class=md-nav__link> With Renovate </a> </li> <li class=md-nav__item> <a href=#with-watchtower class=md-nav__link> With Watchtower </a> </li> <li class=md-nav__item> <a href=#logging-in-automatically class=md-nav__link> Logging in automatically </a> </li> <li class=md-nav__item> <a href=#override-entrypoint class=md-nav__link> Override entrypoint </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#snippets class=md-nav__link> Snippets </a> <nav class=md-nav aria-label=Snippets> <ul class=md-nav__list> <li class=md-nav__item> <a href=#attach-a-docker-to-many-networks class=md-nav__link> Attach a docker to many networks </a> </li> <li class=md-nav__item> <a href=#get-the-output-of-docker-ps-as-a-json class=md-nav__link> Get the output of docker ps as a json </a> </li> <li class=md-nav__item> <a href=#connect-multiple-docker-compose-files class=md-nav__link> Connect multiple docker compose files </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dont-store-credentials-in-plaintext class=md-nav__link> Don't store credentials in plaintext </a> <nav class=md-nav aria-label="Don't store credentials in plaintext"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installing-docker-credential-pass class=md-nav__link> Installing docker-credential-pass </a> </li> <li class=md-nav__item> <a href=#testing-it-works class=md-nav__link> Testing it works </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#start-request-repeated-too-quickly class=md-nav__link> Start request repeated too quickly </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Docker</h1> <p><a href=https://en.wikipedia.org/wiki/Docker_%28software%29>Docker</a> is a set of platform as a service (PaaS) products that use OS-level virtualization to deliver software in packages called containers. Containers are isolated from one another and bundle their own software, libraries and configuration files; they can communicate with each other through well-defined channels. Because all of the containers share the services of a single operating system kernel, they use fewer resources than virtual machines.</p> <h2 id=how-to-keep-containers-updated>How to keep containers updated<a class=headerlink href=#how-to-keep-containers-updated title="Permanent link">⚑</a></h2> <h3 id=with-renovate><a href=../renovate/ >With Renovate</a><a class=headerlink href=#with-renovate title="Permanent link">⚑</a></h3> <p><a href=../renovate/ >Renovate</a> is a program that does automated dependency updates. Multi-platform and multi-language.</p> <h3 id=with-watchtower>With Watchtower<a class=headerlink href=#with-watchtower title="Permanent link">⚑</a></h3> <p>With <a href=https://containrrr.dev/watchtower/ >watchtower</a> you can update the running version of your containerized app simply by pushing a new image to the Docker Hub or your own image registry. Watchtower will pull down your new image, gracefully shut down your existing container and restart it with the same options that were used when it was deployed initially.</p> <p>Run the watchtower container with the next command:</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span><span class=se>\</span>
--name<span class=w> </span>watchtower<span class=w> </span><span class=se>\</span>
-v<span class=w> </span>/var/run/docker.sock:/var/run/docker.sock<span class=w> </span><span class=se>\</span>
-v<span class=w> </span>/etc/localtime:/etc/localtime:ro<span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=nv>WATCHTOWER_NOTIFICATIONS</span><span class=o>=</span>email<span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=nv>WATCHTOWER_NOTIFICATION_EMAIL_FROM</span><span class=o>={{</span><span class=w> </span>email.from<span class=w> </span><span class=o>}}</span><span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=nv>WATCHTOWER_NOTIFICATION_EMAIL_TO</span><span class=o>={{</span><span class=w> </span>email.to<span class=w> </span><span class=o>}}</span><span class=w> </span><span class=se>\\</span>
-e<span class=w> </span><span class=nv>WATCHTOWER_NOTIFICATION_EMAIL_SERVER</span><span class=o>=</span>mail.riseup.net<span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=nv>WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PORT</span><span class=o>=</span><span class=m>587</span><span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=nv>WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER</span><span class=o>={{</span><span class=w> </span>email.user<span class=w> </span><span class=o>}}</span><span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=nv>WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PASSWORD</span><span class=o>={{</span><span class=w> </span>email.password<span class=w> </span><span class=o>}}</span><span class=w> </span><span class=se>\</span>
-e<span class=w> </span><span class=nv>WATCHTOWER_NOTIFICATION_EMAIL_DELAY</span><span class=o>=</span><span class=m>2</span><span class=w> </span><span class=se>\</span>
containrrr/watchtower:latest<span class=w> </span>--no-restart<span class=w> </span>--no-startup-message
</code></pre></div> <p>Use the <code>--no-restart</code> flag if you use systemd to manage the dockers, and <code>--no-startup-message</code> if you don't want watchtower to send you an email each time it starts the update process.</p> <p>Keep in mind that if the containers don't have good migration scripts, upgrading may break the service. To enable this feature, make sure you have frequent backups and a tested rollback process. If you're not sure one of the containers is going to behave well, you can only monitor it or disable it by using docker labels.</p> <p>The first check will be done by default in the next 24 hours, to check that everything works use the <code>--run-once</code> flag.</p> <p>Another alternative is <a href=https://github.com/crazy-max/diun>Diun</a>, which is a CLI application written in Go and delivered as a single executable (and a Docker image) to receive notifications when a Docker image is updated on a Docker registry.</p> <p>They don't <a href=https://github.com/crazy-max/diun/issues/201>yet support Prometheus metrics</a> but it surely looks promising.</p> <h3 id=logging-in-automatically><a href=https://docs.docker.com/engine/reference/commandline/login/#provide-a-password-using-stdin>Logging in automatically</a><a class=headerlink href=#logging-in-automatically title="Permanent link">⚑</a></h3> <p>To log in automatically without entering the password, you need to have the password stored in your <em>personal password store</em> (not in root's!), imagine it's in the <code>dockerhub</code> entry. Then you can use:</p> <div class=highlight><pre><span></span><code>pass<span class=w> </span>show<span class=w> </span>dockerhub<span class=w> </span><span class=p>|</span><span class=w> </span>docker<span class=w> </span>login<span class=w> </span>--username<span class=w> </span>foo<span class=w> </span>--password-stdin
</code></pre></div> <h3 id=override-entrypoint><a href=https://phoenixnap.com/kb/docker-run-override-entrypoint>Override entrypoint</a><a class=headerlink href=#override-entrypoint title="Permanent link">⚑</a></h3> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>docker<span class=w> </span>run<span class=w> </span>-it<span class=w> </span>--entrypoint<span class=w> </span>/bin/bash<span class=w> </span><span class=o>[</span>docker_image<span class=o>]</span>
</code></pre></div> <h2 id=snippets>Snippets<a class=headerlink href=#snippets title="Permanent link">⚑</a></h2> <h3 id=attach-a-docker-to-many-networks>Attach a docker to many networks<a class=headerlink href=#attach-a-docker-to-many-networks title="Permanent link">⚑</a></h3> <p>You can't do it through the <code>docker run</code> command, there you can only specify one network. However, you can attach a docker to a network with the command:</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>network<span class=w> </span>attach<span class=w> </span>network-name<span class=w> </span>docker-name
</code></pre></div> <h3 id=get-the-output-of-docker-ps-as-a-json><a href=https://stackoverflow.com/questions/61586686/golang-template-to-format-docker-ps-output-as-json>Get the output of <code>docker ps</code> as a json</a><a class=headerlink href=#get-the-output-of-docker-ps-as-a-json title="Permanent link">⚑</a></h3> <p>To get the complete json for reference.</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>ps<span class=w> </span>-a<span class=w> </span>--format<span class=w> </span><span class=s2>&quot;{{json .}}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-s
</code></pre></div> <p>To get only the required columns in the output with tab separated version</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>ps<span class=w> </span>-a<span class=w> </span>--format<span class=w> </span><span class=s2>&quot;{{json .}}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;[.ID, .State, .Names, .Image]&#39;</span>
</code></pre></div> <p>To get <a href=https://stackoverflow.com/questions/54075456/docker-ps-show-image-id-instead-of-name>also the image's ID</a> you can use:</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>inspect<span class=w> </span>--format<span class=o>=</span><span class=s1>&#39;{{json .}}&#39;</span><span class=w> </span><span class=k>$(</span>docker<span class=w> </span>ps<span class=w> </span>-aq<span class=k>)</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;[.Id, .Name, .Config.Image, .Image]&#39;</span>
</code></pre></div> <h3 id=connect-multiple-docker-compose-files><a href=https://tjtelan.com/blog/how-to-link-multiple-docker-compose-via-network/ >Connect multiple docker compose files</a><a class=headerlink href=#connect-multiple-docker-compose-files title="Permanent link">⚑</a></h3> <p>You can connect services defined across multiple docker-compose.yml files.</p> <p>In order to do this you’ll need to:</p> <ul> <li>Create an external network with <code>docker network create &lt;network name&gt;</code></li> <li>In each of your <code>docker-compose.yml</code> configure the default network to use your externally created network with the networks top-level key.</li> <li>You can use either the service name or container name to connect between containers.</li> </ul> <p>Let's do it with an example:</p> <ul> <li> <p>Creating the network</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>docker<span class=w> </span>network<span class=w> </span>create<span class=w> </span>external-example
2af4d92c2054e9deb86edaea8bb55ecb74f84a62aec7614c9f09fee386f248a6
</code></pre></div> </li> <li> <p>Create the first docker-compose file</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3&#39;</span>
<span class=nt>services</span><span class=p>:</span>
<span class=w>  </span><span class=nt>service1</span><span class=p>:</span>
<span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sleep infinity</span>

<span class=nt>networks</span><span class=p>:</span>
<span class=w>  </span><span class=nt>default</span><span class=p>:</span>
<span class=w>    </span><span class=nt>external</span><span class=p>:</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">external-example</span>
</code></pre></div> </li> <li> <p>Bring the service up</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>docker-compose<span class=w> </span>up<span class=w> </span>-d
Creating<span class=w> </span>compose1_service1_1<span class=w> </span>...<span class=w> </span><span class=k>done</span>
</code></pre></div> </li> <li> <p>Create the second docker-compose file with network configured</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3&#39;</span>
<span class=nt>services</span><span class=p>:</span>
<span class=w>  </span><span class=nt>service2</span><span class=p>:</span>
<span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
<span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sleep infinity</span>

<span class=nt>networks</span><span class=p>:</span>
<span class=w>  </span><span class=nt>default</span><span class=p>:</span>
<span class=w>    </span><span class=nt>external</span><span class=p>:</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">external-example</span>
</code></pre></div> </li> <li> <p>Bring the service up</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>docker-compose<span class=w> </span>up<span class=w> </span>-d
Creating<span class=w> </span>compose2_service2_1<span class=w> </span>...<span class=w> </span><span class=k>done</span>
</code></pre></div> </li> </ul> <p>After running <code>docker-compose up -d</code> on both docker-compose.yml files, we see that no new networks were created.</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>docker<span class=w> </span>network<span class=w> </span>ls
NETWORK<span class=w> </span>ID<span class=w>          </span>NAME<span class=w>                </span>DRIVER<span class=w>              </span>SCOPE
25e0c599d5e5<span class=w>        </span>bridge<span class=w>              </span>bridge<span class=w>              </span><span class=nb>local</span>
2af4d92c2054<span class=w>        </span>external-example<span class=w>    </span>bridge<span class=w>              </span><span class=nb>local</span>
7df4631e9cff<span class=w>        </span>host<span class=w>                </span>host<span class=w>                </span><span class=nb>local</span>
194d4156d7ab<span class=w>        </span>none<span class=w>                </span>null<span class=w>                </span><span class=nb>local</span>
</code></pre></div> <p>With the containers using the external-example network, they are able to ping one another.</p> <div class=highlight><pre><span></span><code><span class=c1># By service name</span>
$<span class=w> </span>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>compose1_service1_1<span class=w> </span>ping<span class=w> </span>service2
PING<span class=w> </span>service2<span class=w> </span><span class=o>(</span><span class=m>172</span>.24.0.3<span class=o>)</span>:<span class=w> </span><span class=m>56</span><span class=w> </span>data<span class=w> </span>bytes
<span class=m>64</span><span class=w> </span>bytes<span class=w> </span>from<span class=w> </span><span class=m>172</span>.24.0.3:<span class=w> </span><span class=nv>seq</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=nv>ttl</span><span class=o>=</span><span class=m>64</span><span class=w> </span><span class=nv>time</span><span class=o>=</span><span class=m>0</span>.054<span class=w> </span>ms
^C
---<span class=w> </span>service2<span class=w> </span>ping<span class=w> </span>statistics<span class=w> </span>---
<span class=m>1</span><span class=w> </span>packets<span class=w> </span>transmitted,<span class=w> </span><span class=m>1</span><span class=w> </span>packets<span class=w> </span>received,<span class=w> </span><span class=m>0</span>%<span class=w> </span>packet<span class=w> </span>loss
round-trip<span class=w> </span>min/avg/max<span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span>.054/0.054/0.054<span class=w> </span>ms

<span class=c1># By container name</span>
$<span class=w> </span>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>compose1_service1_1<span class=w> </span>ping<span class=w> </span>compose2_service2_1
PING<span class=w> </span>compose2_service2_1<span class=w> </span><span class=o>(</span><span class=m>172</span>.24.0.2<span class=o>)</span>:<span class=w> </span><span class=m>56</span><span class=w> </span>data<span class=w> </span>bytes
<span class=m>64</span><span class=w> </span>bytes<span class=w> </span>from<span class=w> </span><span class=m>172</span>.24.0.2:<span class=w> </span><span class=nv>seq</span><span class=o>=</span><span class=m>0</span><span class=w> </span><span class=nv>ttl</span><span class=o>=</span><span class=m>64</span><span class=w> </span><span class=nv>time</span><span class=o>=</span><span class=m>0</span>.042<span class=w> </span>ms
^C
---<span class=w> </span>compose2_service2_1<span class=w> </span>ping<span class=w> </span>statistics<span class=w> </span>---
<span class=m>1</span><span class=w> </span>packets<span class=w> </span>transmitted,<span class=w> </span><span class=m>1</span><span class=w> </span>packets<span class=w> </span>received,<span class=w> </span><span class=m>0</span>%<span class=w> </span>packet<span class=w> </span>loss
round-trip<span class=w> </span>min/avg/max<span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span>.042/0.042/0.042<span class=w> </span>ms
</code></pre></div> <p>The other way around works too.</p> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">⚑</a></h2> <p>If you are using a VPN and docker, you're going to have a hard time.</p> <p>The <code>docker</code> systemd service logs <code>systemctl status docker.service</code> usually doesn't give much information. Try to start the daemon directly with <code>sudo /usr/bin/dockerd</code>.</p> <h3 id=dont-store-credentials-in-plaintext>Don't store credentials in plaintext<a class=headerlink href=#dont-store-credentials-in-plaintext title="Permanent link">⚑</a></h3> <div class="admonition warning"> <p class=admonition-title>It doesn't work, don't go this painful road and assume that docker is broken.</p> <p>The official steps are horrible, and once you've spent two hours debugging it, you <a href=https://github.com/docker/docker-credential-helpers/issues/154>won't be able to push or pull images with your user</a>.</p> </div> <p>When you use <code>docker login</code> and introduce the user and password you get the next warning:</p> <div class=highlight><pre><span></span><code>WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store
</code></pre></div> <p>I got a nice surprise when I saw that <code>pass</code> was suggested in the link of the warning, to be used as a backend to store the password. But that feeling soon faded.</p> <p>To make docker understand that you want to use <code>pass</code> you need to use the <a href=https://github.com/docker/docker-credential-helpers/releases><code>docker-credential-pass</code></a> script. A Go script "maintained" by docker, whose last commit was two years ago , has the CI broken and many old unanswered issues. Setting it up it's not easy either and it's <a href=https://github.com/docker/docker-credential-helpers/issues/102>ill documented</a>.</p> <p>Furthermore, the script doesn't do what I expected, which is to store the password of your registry user in a pass entry. Instead, you need to create an empty pass entry in <code>docker-credential-helpers/docker-pass-initialized-check</code>, and when you use <code>docker login</code>, manually introducing your data, it creates another entry, as you can see in the next <code>pass</code> output:</p> <div class=highlight><pre><span></span><code>Password Store
└── docker-credential-helpers
    ├── aHR0cHM6Ly9pbmRleC5kb2NrZXIuaW8vdjEv
    │   └── lyz
    └── docker-pass-initialized-check
</code></pre></div> <p>That entry is removed when you use <code>docker logout</code> so the next time you log in you need to introduce the user and password <code>(╯°□°)╯ ┻━┻</code>.</p> <h4 id=installing-docker-credential-pass>Installing docker-credential-pass<a class=headerlink href=#installing-docker-credential-pass title="Permanent link">⚑</a></h4> <p>You first need to install the script:</p> <div class=highlight><pre><span></span><code><span class=c1># Check for later releases at https://github.com/docker/docker-credential-helpers/releases</span>
<span class=nv>version</span><span class=o>=</span><span class=s2>&quot;v0.6.3&quot;</span>
<span class=nv>archive</span><span class=o>=</span><span class=s2>&quot;docker-credential-pass-</span><span class=nv>$version</span><span class=s2>-amd64.tar.gz&quot;</span>
<span class=nv>url</span><span class=o>=</span><span class=s2>&quot;https://github.com/docker/docker-credential-helpers/releases/download/</span><span class=nv>$version</span><span class=s2>/</span><span class=nv>$archive</span><span class=s2>&quot;</span>

<span class=c1># Download cred helper, unpack, make executable, and move it where Docker will find it.</span>
wget<span class=w> </span><span class=nv>$url</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>tar<span class=w> </span>-xf<span class=w> </span><span class=nv>$archive</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>docker-credential-pass<span class=w> </span><span class=se>\</span>
<span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>mv<span class=w> </span>-f<span class=w> </span>docker-credential-pass<span class=w> </span>/usr/local/bin/
</code></pre></div> <p>Another tricky issue is that even if you use a non-root user who's part of the <code>docker</code> group, the script is not aware of that, so it will <em>look in the password store of root</em> instead of the user's. This means that additionally to your own, you need to create a new password store for root. Follow the next steps with the root user:</p> <ul> <li>Create the password with <code>gpg --full-gen</code>, and copy the key id. Use a non empty password, otherwise you are getting the same security as with the password in cleartext.</li> <li>Initialize the password store <code>pass init gpg_id</code>, changing <code>gpg_id</code> for the one of the last step.</li> <li> <p>Create the <em>empty</em> <code>docker-credential-helpers/docker-pass-initialized-check</code> entry:</p> <div class=highlight><pre><span></span><code>pass<span class=w> </span>insert<span class=w> </span>docker-credential-helpers/docker-pass-initialized-check
</code></pre></div> <p>And press enter twice.</p> </li> </ul> <p>Finally we need to specify in the root's docker configuration that we want to use the <code>pass</code> credential storage.</p> <div class="admonition note"> <p class=admonition-title>File: /root/.docker/config.json</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;credsStore&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pass&quot;</span>
<span class=p>}</span>
</code></pre></div> </div> <h4 id=testing-it-works>Testing it works<a class=headerlink href=#testing-it-works title="Permanent link">⚑</a></h4> <p>To test that docker is able to use pass as backend to store the credentials, run <code>docker login</code> and introduce the user and password. You should see the <code>Login Succeeded</code> message without any warning.</p> <div class=highlight><pre><span></span><code>Login with your Docker ID to push and pull images from Docker Hub. If you don&#39;t have a Docker ID, head over to https://hub.docker.com to create one.
Username: lyz
Password:
Login Succeeded
</code></pre></div> <p>Awful experience, wasn't it? Don't worry it gets worse.</p> <p>Now that you're logged in, whenever you try to push an image you're probably going to get an <code>denied: requested access to the resource is denied</code> error. That's because docker is not able to use the password it has stored in the root's password store. If you're using <code>root</code> to push the image (bad idea anyway), you will need to <code>export GPG_TTY=$(tty)</code> so that docker can ask you for your password to unlock root's <code>pass</code> entry. If you're like me that uses a non-root user belonging to the <code>docker</code> group, not even that works, so you've spent all this time reading and trying to fix everything for nothing... Thank you Docker <code>-.-</code>.</p> <h3 id=start-request-repeated-too-quickly><a href=https://askubuntu.com/questions/1222440/why-wont-the-docker-service-start>Start request repeated too quickly</a><a class=headerlink href=#start-request-repeated-too-quickly title="Permanent link">⚑</a></h3> <p>Shutdown the VPN and it will work. If it doesn't inspect the output of <code>journalctl -eu docker</code>.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2023-03-23T22:40:13+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-03-23</span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/nullniverse target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.footer", "navigation.instant", "navigation.top", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.220ee61c.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>